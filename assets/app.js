angular.module("app",["ngRoute","ngAnimate"]),angular.module("app").controller("ApplicationCtrl",["$scope","$rootScope","UserSvc",function(t,e,n){window.localStorage.token&&n.getUser().then(function(e){t.$emit("userLoggedIn",e.data)}),t.$on("userLoggedIn",function(e,n){t.currentUser=n})}]),angular.module("app").controller("LoginCtrl",["$scope","UserSvc",function(t,e){t.login=function(n,o){e.login(n,o).then(function(e){t.$emit("userLoggedIn",e.data),window.location.href="#/"},function(e){t.loginValidation="Incorrect username & password combination"})},t.logout=function(){e.logout()}}]),angular.module("app").controller("PostsCtrl",["$scope","$http","PostsService","filterFilter",function(t,e,n,o){t.baseUrl=location.host,t.bodyLengthLimit=250,t.posts=[],t.addPost=function(){var e=CKEDITOR.instances.editor1.getData(),o=t.urlDate(),r=t.slugify(t.postTitle),s=o+r;e&&n.send({body:e,title:t.postTitle,slug:s}).success(function(e){t.postBody=null,CKEDITOR.instances.editor1.setData(""),t.postTitle=null})},t.init_ckedit=function(){CKEDITOR.replace("editor1")},t.$on("ws:new_post",function(e,n){n=n[0],t.$apply(function(){t.posts.unshift(n),t.paginate()})}),t.$on("$viewContentLoaded",function(){}),t.currentPage=1,t.postsPerPage=5,t.prevPage=function(){t.currentPage>1&&t.currentPage--},t.nextPage=function(){t.currentPage<t.posts.length/t.postsPerPage&&t.currentPage++},t.setPage=function(e){t.currentPage=e},t.range=function(t){return new Array(t)},t.currentPage=1,t.postsPerPage=5,t.$watch("search",function(e){t.filteredPosts=o(t.posts,e),t.paginate(t.filteredPosts.length)},!0),t.paginate=function(e){t.numberOfPages=Math.ceil(e>0?e/t.postsPerPage:t.posts.length/t.postsPerPage)},t.urlDate=function(t){if(void 0===t)var e=new Date;else var e=new Date(t);var n=e.getDate(),o=e.getMonth()+1,r=e.getFullYear(),s=String(r)+"-"+String(o)+"-"+String(n)+"-";return s},t.slugify=function(t){var e=t.toLowerCase();return e=e.replace(/\s+/g,"_"),e=e.replace(/\?/g,""),e=e.replace(/\&/g,""),e=e.replace(/\=/g,"")},n.get().success(function(e){t.posts=e,console.log(e),t.paginate(t.posts.length)})}]).filter("output_html",["$sce",function(t){return function(e){return t.trustAsHtml(e)}}]).filter("startFrom",function(){return function(t,e){return t?(e=+e,t.slice(e)):[]}}),angular.module("app").service("PostsService",["$http",function(t){this.get=function(){return t.get("/api/posts")},this.send=function(e){return t.post("/api/posts",e)},this.single_slug=function(e){return t.get("/api/posts",{params:{post_slug:e.slug}})},this.single_id=function(e){return t.get("/api/posts",{params:{post_id:e.id}})}}]),angular.module("app").controller("RegisterCtrl",["$scope","UserSvc",function(t,e){t.register=function(n,o,r){return o!=r?void(t.validationMessage="Your passwords did not match."):void e.register(n,o)}}]),angular.module("app").config(["$routeProvider",function(t){t.when("/",{controller:"PostsCtrl",templateUrl:"posts.html"}).when("/register",{controller:"RegisterCtrl",templateUrl:"register.html"}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html"}).when("/logout",{controller:"LoginCtrl",templateUrl:"logout.html"}).when("/post/:slug",{controller:"SinglePostCtrl",templateUrl:"singlePost.html"}).when("/post/id/:id",{controller:"SinglePostCtrl",templateUrl:"singlePost.html"})}]),angular.module("app").controller("SinglePostCtrl",["$scope","$http","PostsService","$routeParams","$route","$location",function(t,e,n,o,r,s){var i=o.slug,a=o.id;t.$on("$viewContentLoaded",function(){}),i?n.single_slug({slug:i}).success(function(e){t.post=e}):n.single_id({id:a}).success(function(e){t.post=e})}]),angular.module("app").service("UserSvc",["$http",function(t){var e=this;e.getUser=function(){return t.defaults.headers.common["X-Auth"]=window.localStorage.token,t.get("/api/users").then(function(t){return t})},e.login=function(n,o){return t.post("/api/sessions",{username:n,password:o}).then(function(n){return window.localStorage.token=n.data,t.defaults.headers.common["X-Auth"]=n.data,e.getUser()})},e.register=function(n,o,r){return t.post("/api/users",{username:n,password:o}).then(function(t){return e.login(n,o).then(function(){window.location.href="/"})})},e.logout=function(){window.localStorage.removeItem("token"),window.location.href="/"}}]),angular.module("app").run(["$rootScope","$timeout","$window",function(t,e,n){!function o(){var r="ws://"+n.location.host,s=new WebSocket(r);s.onopen=function(){},s.onclose=function(t){e(o,1e4)},s.onmessage=function(e){var n=JSON.parse(e.data),o="ws:"+n.topic,r=n.data;t.$broadcast(o,r)}}()}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uQ3RybC5qcyIsImxvZ2luQ3J0bC5qcyIsInBvc3RzQ3RybC5qcyIsInBvc3RzU2VydmljZS5qcyIsInJlZ2lzdHJhdGlvbkN0cmwuanMiLCJyb3V0ZXMuanMiLCJzaW5nbGVQb3N0c0N0cmwuanMiLCJ1c2VyU2VydmljZS5qcyIsIndlYnNvY2tldHMuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbnRyb2xsZXIiLCIkc2NvcGUiLCIkcm9vdFNjb3BlIiwiVXNlclN2YyIsIndpbmRvdyIsImxvY2FsU3RvcmFnZSIsInRva2VuIiwiZ2V0VXNlciIsInRoZW4iLCJyZXNwb25zZSIsIiRlbWl0IiwiZGF0YSIsIiRvbiIsImV2ZW50IiwidXNlciIsImN1cnJlbnRVc2VyIiwibG9naW4iLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwibG9jYXRpb24iLCJocmVmIiwiZXJyb3IiLCJsb2dpblZhbGlkYXRpb24iLCJsb2dvdXQiLCIkaHR0cCIsIlBvc3RzU2VydmljZSIsImZpbHRlckZpbHRlciIsImJhc2VVcmwiLCJob3N0IiwiYm9keUxlbmd0aExpbWl0IiwicG9zdHMiLCJhZGRQb3N0IiwiY2tlZGl0b3JfY29udGVudCIsIkNLRURJVE9SIiwiaW5zdGFuY2VzIiwiZWRpdG9yMSIsImdldERhdGEiLCJkYXRlX3NsdWciLCJ1cmxEYXRlIiwidGl0bGVfc2x1ZyIsInNsdWdpZnkiLCJwb3N0VGl0bGUiLCJzbHVnIiwic2VuZCIsImJvZHkiLCJ0aXRsZSIsInN1Y2Nlc3MiLCJwb3N0IiwicG9zdEJvZHkiLCJzZXREYXRhIiwiaW5pdF9ja2VkaXQiLCJyZXBsYWNlIiwiXyIsIiRhcHBseSIsInVuc2hpZnQiLCJwYWdpbmF0ZSIsImN1cnJlbnRQYWdlIiwicG9zdHNQZXJQYWdlIiwicHJldlBhZ2UiLCJuZXh0UGFnZSIsImxlbmd0aCIsInNldFBhZ2UiLCJwYWdlX251bWJlciIsInJhbmdlIiwibiIsIkFycmF5IiwiJHdhdGNoIiwidGVybSIsImZpbHRlcmVkUG9zdHMiLCJudW1iZXJfb2ZfaXRlbXMiLCJudW1iZXJPZlBhZ2VzIiwiTWF0aCIsImNlaWwiLCJ0aW1lIiwidW5kZWZpbmVkIiwiZGF0ZSIsIkRhdGUiLCJkYXkiLCJnZXREYXRlIiwibW9udGgiLCJnZXRNb250aCIsInllYXIiLCJnZXRGdWxsWWVhciIsInVybF9kYXRlIiwiU3RyaW5nIiwic3RyaW5nIiwidG9Mb3dlckNhc2UiLCJnZXQiLCJjb25zb2xlIiwibG9nIiwiZmlsdGVyIiwiJHNjZSIsInZhbCIsInRydXN0QXNIdG1sIiwiaW5wdXQiLCJzdGFydCIsInNsaWNlIiwic2VydmljZSIsInRoaXMiLCJzaW5nbGVfc2x1ZyIsInBhcmFtZXRlcnMiLCJwYXJhbXMiLCJwb3N0X3NsdWciLCJzaW5nbGVfaWQiLCJwb3N0X2lkIiwiaWQiLCJyZWdpc3RlciIsInBhc3N3b3JkX2NvbmZpcm0iLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiJHJvdXRlUGFyYW1zIiwiJHJvdXRlIiwiJGxvY2F0aW9uIiwic3ZjIiwiZGVmYXVsdHMiLCJoZWFkZXJzIiwiY29tbW9uIiwicmVtb3ZlSXRlbSIsInJ1biIsIiR0aW1lb3V0IiwiJHdpbmRvdyIsImNvbm5lY3QiLCJjb25uZWN0aW9uIiwiV2ViU29ja2V0Iiwib25vcGVuIiwib25jbG9zZSIsImUiLCJvbm1lc3NhZ2UiLCJtZXNzYWdlIiwiSlNPTiIsInBhcnNlIiwibmFtZSIsInRvcGljIiwiJGJyb2FkY2FzdCJdLCJtYXBwaW5ncyI6IkFBQ0FBLFFBQUFDLE9BQUEsT0FBQSxVQUFBLGNDREFELFFBQUFDLE9BQUEsT0FDQUMsV0FBQSxtQkFBQSxTQUFBLGFBQUEsVUFBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQU9BQyxPQUFBQyxhQUFBQyxPQUNBSCxFQUFBSSxVQUNBQyxLQUFBLFNBQUFDLEdBQ0FSLEVBQUFTLE1BQUEsZUFBQUQsRUFBQUUs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QUMsR0FDQVYsS0FBQSxXQUNBSixPQUFBZSxTQUFBQyxLQUFBLFNBSUFnRyxFQUFBN0YsT0FBQSxXQUNBbkIsT0FBQUMsYUFBQW1ILFdBQUEsU0FDQXBILE9BQUFlLFNBQUFDLEtBQUEsUUNqQ0F0QixRQUFBQyxPQUFBLE9BQ0EwSCxLQUFBLGFBQUEsV0FBQSxVQUFBLFNBQUF2SCxFQUFBd0gsRUFBQUMsSUFFQSxRQUFBQyxLQUVBLEdBQUFoRyxHQUFBLFFBQUErRixFQUFBeEcsU0FBQVMsS0FFQWlHLEVBQUEsR0FBQUMsV0FBQWxHLEVBRUFpRyxHQUFBRSxPQUFBLGFBS0FGLEVBQUFHLFFBQUEsU0FBQUMsR0FFQVAsRUFBQUUsRUFBQSxNQUdBQyxFQUFBSyxVQUFBLFNBQUFELEdBRUEsR0FBQUUsR0FBQUMsS0FBQUMsTUFBQUosRUFBQXRILE1BRUEySCxFQUFBLE1BQUFILEVBQUFJLE1BQ0E1SCxFQUFBd0gsRUFBQXhILElBR0FULEdBQUFzSSxXQUFBRixFQUFBM0giLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy9UaGlzIGZpbGUgbXVzdCBiZSB0aGUgZmlyc3QgaW4gdGhlIGxpc3QgdG8gYmUgY29uY2F0ZW5hdGVkXG5hbmd1bGFyLm1vZHVsZSgnYXBwJywgWyduZ1JvdXRlJywgJ25nQW5pbWF0ZSddKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuY29udHJvbGxlcignQXBwbGljYXRpb25DdHJsJyAsIFtcIiRzY29wZVwiLCBcIiRyb290U2NvcGVcIiwgXCJVc2VyU3ZjXCIsIGZ1bmN0aW9uICgkc2NvcGUsICRyb290U2NvcGUsIFVzZXJTdmMpIHtcblx0XHQvKlxuXHRcdElmIHdlIGhhdmUgYSBzdG9yZWQgdG9rZW4sIGdldCB0aGUgdXNlciBpbmZvcm1hdGlvbiBmcm9tIGl0XG5cdFx0YW5kIGVtaXQgdGhlIHVzZXIgbG9nZ2VkaW4gbWVzc2FnZXMgaW4gb3JkZXIgdG8gYWxsb3cgdGhlIFVJIHRvIFxuXHRcdGluZGljYXRlIHRvIHRoZSB1c2VyIHRoYXQgdGhleSB3ZXJlIGxvZ2dlZCBpblxuXHRcdCovXG5cdFx0XG5cdFx0aWYgKHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW4pIHtcblx0XHRcdFVzZXJTdmMuZ2V0VXNlcigpXG5cdFx0XHRcdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSl7XG5cdFx0XHRcdFx0JHNjb3BlLiRlbWl0KCd1c2VyTG9nZ2VkSW4nLCByZXNwb25zZS5kYXRhKTtcblx0XHRcdFx0fSlcblx0XHR9XG5cblx0XHQkc2NvcGUuJG9uKCd1c2VyTG9nZ2VkSW4nLCBmdW5jdGlvbihldmVudCwgdXNlcikge1xuXHRcdFx0JHNjb3BlLmN1cnJlbnRVc2VyID0gdXNlcjtcblx0XHR9KVxuXHR9XSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcblx0LmNvbnRyb2xsZXIoJ0xvZ2luQ3RybCcgLCBbXCIkc2NvcGVcIiAsIFwiVXNlclN2Y1wiICwgZnVuY3Rpb24gKCRzY29wZSwgVXNlclN2Yykge1xuXHRcdCRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQpIHtcblx0XHRcdFVzZXJTdmMubG9naW4odXNlcm5hbWUsIHBhc3N3b3JkKVxuXHRcdFx0XHQudGhlbihmdW5jdGlvbiAocmVzcG9uc2Upe1xuXHRcdFx0XHRcdCRzY29wZS4kZW1pdCgndXNlckxvZ2dlZEluJywgcmVzcG9uc2UuZGF0YSk7XG5cdFx0XHRcdFx0d2luZG93LmxvY2F0aW9uLmhyZWYgPSAnIy8nXG5cdFx0XHRcdH0sXG5cdFx0XHRcdGZ1bmN0aW9uKGVycm9yKXtcblx0XHRcdFx0ICAkc2NvcGUubG9naW5WYWxpZGF0aW9uID0gJ0luY29ycmVjdCB1c2VybmFtZSAmIHBhc3N3b3JkIGNvbWJpbmF0aW9uJztcblx0XHRcdFx0fSlcblxuXHRcdH1cblxuXHRcdCRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRVc2VyU3ZjLmxvZ291dCgpXG5cdFx0fVxuXHR9XSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcblx0LmNvbnRyb2xsZXIoJ1Bvc3RzQ3RybCcsIFtcIiRzY29wZVwiICwgXCIkaHR0cFwiLCBcIlBvc3RzU2VydmljZVwiLCBcImZpbHRlckZpbHRlclwiLCBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgUG9zdHNTZXJ2aWNlLCBmaWx0ZXJGaWx0ZXIpIHtcblx0XHQkc2NvcGUuYmFzZVVybCA9IGxvY2F0aW9uLmhvc3Q7XG5cdFx0JHNjb3BlLmJvZHlMZW5ndGhMaW1pdCA9IDI1MDtcblxuXHRcdCRzY29wZS5wb3N0cyA9IFtdO1xuXHRcdCRzY29wZS5hZGRQb3N0ID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0dmFyIGNrZWRpdG9yX2NvbnRlbnQgPSBDS0VESVRPUi5pbnN0YW5jZXMuZWRpdG9yMS5nZXREYXRhKCk7XG5cdFx0XHR2YXIgZGF0ZV9zbHVnID0gJHNjb3BlLnVybERhdGUoKTtcblx0XHRcdHZhciB0aXRsZV9zbHVnID0gJHNjb3BlLnNsdWdpZnkoJHNjb3BlLnBvc3RUaXRsZSk7XG5cblx0XHRcdHZhciBzbHVnID0gZGF0ZV9zbHVnICsgdGl0bGVfc2x1ZztcblxuXHRcdFx0aWYgKGNrZWRpdG9yX2NvbnRlbnQpIHtcblx0XHRcdFx0UG9zdHNTZXJ2aWNlLnNlbmQoe1xuXHRcdFx0XHRcdGJvZHk6IGNrZWRpdG9yX2NvbnRlbnQsXG5cdFx0XHRcdFx0dGl0bGU6ICRzY29wZS5wb3N0VGl0bGUsXG5cdFx0XHRcdFx0c2x1Zzogc2x1Z1xuXHRcdFx0XHR9KVxuXHRcdFx0XHQuc3VjY2VzcyhmdW5jdGlvbiAocG9zdCkge1xuXHRcdFx0XHRcdC8qXG5cdFx0XHRcdFx0Ly9SZW1vdmVkIGFzIHdlYnNvY2tldCBicm9hZGNhc3Qgd291bGQgY2F1c2UgdGhlIHBvc3QgdG8gYXBwZWFyIGR1cGxpY2F0ZWQgb24gdGhlIGJyb3dzZXIgdGhhdCBpdCB3YXMgcG9zdGVkIGZyb20gXG5cdFx0XHRcdFx0Ly9hcyBib3RoIG9mIHRoZSBmdW5jdGlvbnMgd291bGQgZ2V0IGV4ZWN1dGVkIGJlY2F1c2UgdGhlIGNsaWVudCB3aG8gc2VuZHMgdGhlIHBvc3Qgd291bGQgc3RpbGwgcmVjaWV2ZSB0aGUgd2Vic29ja2V0cyBicm9hZGNhc3QgYmFjayBmcm9tIHRoZSBzZXJ2ZXIgIFxuXHRcdFx0XHRcdCovXG5cdFx0XHRcdFx0JHNjb3BlLnBvc3RCb2R5ID0gbnVsbDtcblx0XHRcdFx0XHRDS0VESVRPUi5pbnN0YW5jZXMuZWRpdG9yMS5zZXREYXRhKCcnKTtcblx0XHRcdFx0XHQkc2NvcGUucG9zdFRpdGxlID0gbnVsbDtcblx0XHRcdFx0fSlcblx0XHRcdH1cblx0XHR9XG5cblx0XHQkc2NvcGUuaW5pdF9ja2VkaXQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0ICAgIENLRURJVE9SLnJlcGxhY2UoJ2VkaXRvcjEnKTtcblx0XHR9XG5cblx0XHQkc2NvcGUuJG9uKCd3czpuZXdfcG9zdCcsIGZ1bmN0aW9uKF8sIHBvc3QpIHtcblx0XHRcdHBvc3QgPSBwb3N0WzBdO1xuXHRcdFx0JHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdCRzY29wZS5wb3N0cy51bnNoaWZ0KHBvc3QpO1xuXHRcdFx0XHQkc2NvcGUucGFnaW5hdGUoKTtcblx0XHRcdH0pXG5cdFx0fSlcblxuXHRcdCRzY29wZS4kb24oJyR2aWV3Q29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCl7XG5cdFx0XHQvL3RoZSBwYWdlIGlzIHJlYWR5XG5cdFx0fSk7XG5cblx0XHQkc2NvcGUuY3VycmVudFBhZ2UgPSAxO1xuXHRcdCRzY29wZS5wb3N0c1BlclBhZ2UgPSA1O1xuXG5cdFx0JHNjb3BlLnByZXZQYWdlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIGlmICgkc2NvcGUuY3VycmVudFBhZ2UgPiAxKSB7XG5cdCAgICAgICAgICAgICRzY29wZS5jdXJyZW50UGFnZS0tO1xuXHQgICAgICAgIH1cblx0ICAgIH07XG4gICAgXG5cdCAgICAkc2NvcGUubmV4dFBhZ2UgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgaWYgKCRzY29wZS5jdXJyZW50UGFnZSA8ICRzY29wZS5wb3N0cy5sZW5ndGgvJHNjb3BlLnBvc3RzUGVyUGFnZSkge1xuXHQgICAgICAgICAgICAkc2NvcGUuY3VycmVudFBhZ2UrKztcblx0ICAgICAgICB9XG5cdCAgICB9O1xuXHQgICAgXG5cdCAgICAkc2NvcGUuc2V0UGFnZSA9IGZ1bmN0aW9uIChwYWdlX251bWJlcikge1xuXHQgICAgICAgICRzY29wZS5jdXJyZW50UGFnZSA9IHBhZ2VfbnVtYmVyO1xuXHQgICAgfTtcblxuXHQgICAgLy9UaGlzIHdheSBJIGNhbiBkbzogIFwiPGxpIG5nLXJlcGVhdD1cIm4gaW4gcmFuZ2UocGFnZXMpIHRyYWNrIGJ5ICRpbmRleFwiPlwiIGFuZCBzbyBJIGNhbiBkaXNwbGF5IGFzIG1hbnkgaXRlbXMgYXMgdGhlIHZhbHVlIG9mIGEgbnVtYmVyIGFzIHRoaXMgcmV0dXJucyBhbiBhcnJheSBvZiB0aGF0IGxlbmdodFxuXHQgICAgJHNjb3BlLnJhbmdlID0gZnVuY3Rpb24obikge1xuICAgICAgICBcdHJldHVybiBuZXcgQXJyYXkobik7XG4gICAgXHR9O1xuXG5cdCAgICAkc2NvcGUuY3VycmVudFBhZ2UgPSAxOyAvL2N1cnJlbnQgcGFnZVxuXHQgICAgJHNjb3BlLnBvc3RzUGVyUGFnZSA9IDU7IC8vbWF4IHJvd3MgZm9yIGRhdGEgdGFibGVcblx0ICAgIFxuXHQgICAgLy93YXRjaCB0byBzZWUgaWYgc2VhcmNoaW5nIGFuZCByZXBhZ2luYXRlIGlmIHdlIGFyZVxuXHQgICAgLy90cnVlIGF0IHRoZSBlbmQgIG1hZ2ljYWxseSBtYWtlcyBpdCBzbyB0aGF0IGFzIGVhY2ggZXh0cmEgbGV0dGVyIGlzIGFkZGVkIHRvIHRoZSBzZWFyY2ggd2UgY2FuIHJlcGFnaW5hdGVcblx0ICAgIC8vd2l0aG91dCB0aGUgJ3RydWUnIGl0IG9ubHkgZGlkICB0aGF0XG5cdCAgICAkc2NvcGUuJHdhdGNoKCdzZWFyY2gnLCBmdW5jdGlvbih0ZXJtKSB7XG5cdCAgICAgICAgJHNjb3BlLmZpbHRlcmVkUG9zdHMgPSBmaWx0ZXJGaWx0ZXIoJHNjb3BlLnBvc3RzLCB0ZXJtKTtcblx0ICAgICAgICAkc2NvcGUucGFnaW5hdGUoJHNjb3BlLmZpbHRlcmVkUG9zdHMubGVuZ3RoKTtcblx0ICAgIH0sIHRydWUpO1xuXG5cblx0ICAgICRzY29wZS5wYWdpbmF0ZSA9IGZ1bmN0aW9uKG51bWJlcl9vZl9pdGVtcyl7XG5cdCAgICBcdGlmIChudW1iZXJfb2ZfaXRlbXMgPiAwKSB7XG5cdCAgICAgICAgXHQkc2NvcGUubnVtYmVyT2ZQYWdlcyA9IE1hdGguY2VpbChudW1iZXJfb2ZfaXRlbXMvJHNjb3BlLnBvc3RzUGVyUGFnZSk7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIGVsc2Uge1xuXHQgICAgICAgIFx0JHNjb3BlLm51bWJlck9mUGFnZXMgPSBNYXRoLmNlaWwoJHNjb3BlLnBvc3RzLmxlbmd0aC8kc2NvcGUucG9zdHNQZXJQYWdlKTtcblx0ICAgICAgICB9XG5cdCAgICB9O1xuXG5cdCAgICAkc2NvcGUudXJsRGF0ZSA9IGZ1bmN0aW9uKHRpbWUpIHtcblx0XHRcdGlmICh0aW1lID09PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0dmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdHZhciBkYXRlID0gbmV3IERhdGUodGltZSk7XG5cdFx0XHR9XG5cdFx0ICAgIHZhciBkYXkgPSBkYXRlLmdldERhdGUoKTtcblx0XHQgICAgdmFyIG1vbnRoID0gZGF0ZS5nZXRNb250aCgpKzE7IC8vKzEgYmVjYXVzZSBtb250aHMgYXJlIDAgaW5kZXhlZFxuXHRcdCAgICB2YXIgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcblxuXHRcdCAgICB2YXIgdXJsX2RhdGUgPSAgU3RyaW5nKHllYXIpICsgJy0nICsgU3RyaW5nKG1vbnRoKSArICctJyArIFN0cmluZyhkYXkpICsgJy0nIDtcblxuXHRcdFx0cmV0dXJuIHVybF9kYXRlO1xuXG5cdCAgICB9O1xuXG5cdCAgICAkc2NvcGUuc2x1Z2lmeSA9IGZ1bmN0aW9uKHN0cmluZykge1xuXHQgICAgXHR2YXIgc2x1ZyA9ICBzdHJpbmcudG9Mb3dlckNhc2UoKTtcblx0ICAgIFx0c2x1ZyA9IHNsdWcucmVwbGFjZSgvXFxzKy9nLFwiX1wiKTtcblx0ICAgIFx0c2x1ZyA9IHNsdWcucmVwbGFjZSgvXFw/L2csIFwiXCIpO1xuXHQgICAgXHRzbHVnID0gc2x1Zy5yZXBsYWNlKC9cXCYvZywgXCJcIik7XG5cdCAgICBcdHNsdWcgPSBzbHVnLnJlcGxhY2UoL1xcPS9nLCBcIlwiKTtcblx0ICAgIFx0cmV0dXJuIHNsdWc7XG5cdCAgICB9O1xuXG5cdFBvc3RzU2VydmljZS5nZXQoKVxuXHRcdC5zdWNjZXNzKGZ1bmN0aW9uIChwb3N0cykge1xuXHRcdFx0JHNjb3BlLnBvc3RzID0gcG9zdHM7XG5cdFx0XHRjb25zb2xlLmxvZyhwb3N0cyk7XG5cdFx0XHQkc2NvcGUucGFnaW5hdGUoJHNjb3BlLnBvc3RzLmxlbmd0aCk7XG5cdFx0fSlcblxuXHR9XSlcblxuXHQuZmlsdGVyKCdvdXRwdXRfaHRtbCcsIFtcIiRzY2VcIiwgZnVuY3Rpb24gKCRzY2UpIHtcblx0XHRyZXR1cm4gZnVuY3Rpb24odmFsKSB7XG5cdCAgICAgICAgcmV0dXJuICRzY2UudHJ1c3RBc0h0bWwodmFsKTtcblx0ICAgIH07XG5cdH1dKVxuXG5cdC5maWx0ZXIoJ3N0YXJ0RnJvbScsIGZ1bmN0aW9uKCkge1xuXHQgICAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0LCBzdGFydCkge1xuXHQgICAgICAgIGlmKGlucHV0KSB7XG5cdCAgICAgICAgICAgIHN0YXJ0ID0gK3N0YXJ0OyAvL3BhcnNlIHRvIGludFxuXHQgICAgICAgICAgICByZXR1cm4gaW5wdXQuc2xpY2Uoc3RhcnQpO1xuXHQgICAgICAgIH1cblx0ICAgICAgICByZXR1cm4gW107XG5cdCAgICB9XG5cdH0pOyIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuc2VydmljZSgnUG9zdHNTZXJ2aWNlJywgW1wiJGh0dHBcIiAsIGZ1bmN0aW9uICgkaHR0cCkge1xuXHRcdHRoaXMuZ2V0ID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9wb3N0cycpO1xuXHRcdH1cblx0XHR0aGlzLnNlbmQgPSBmdW5jdGlvbiAocG9zdCkge1xuXHRcdFx0cmV0dXJuICRodHRwLnBvc3QoJy9hcGkvcG9zdHMnLCBwb3N0KTtcblx0XHR9XG5cdFx0dGhpcy5zaW5nbGVfc2x1ZyA9IGZ1bmN0aW9uIChwYXJhbWV0ZXJzKSB7XG5cdFx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3Bvc3RzJywgeyBwYXJhbXM6IHtwb3N0X3NsdWc6IHBhcmFtZXRlcnMuc2x1Z30gfSApO1xuXHRcdH1cblx0XHR0aGlzLnNpbmdsZV9pZCA9IGZ1bmN0aW9uIChwYXJhbWV0ZXJzKSB7XG5cdFx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3Bvc3RzJywgeyBwYXJhbXM6IHtwb3N0X2lkOiBwYXJhbWV0ZXJzLmlkfSB9ICk7XG5cdFx0fVxuXHR9XSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcblx0LmNvbnRyb2xsZXIoJ1JlZ2lzdGVyQ3RybCcgLCBbXCIkc2NvcGVcIiAsIFwiVXNlclN2Y1wiICwgZnVuY3Rpb24gKCRzY29wZSwgVXNlclN2Yykge1xuXHRcdCRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQsIHBhc3N3b3JkX2NvbmZpcm0pIHtcblx0XHRcdGlmIChwYXNzd29yZCAhPSBwYXNzd29yZF9jb25maXJtKSB7XG5cdFx0XHRcdCRzY29wZS52YWxpZGF0aW9uTWVzc2FnZSA9ICdZb3VyIHBhc3N3b3JkcyBkaWQgbm90IG1hdGNoLic7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdFVzZXJTdmMucmVnaXN0ZXIodXNlcm5hbWUsIHBhc3N3b3JkKVxuXHRcdH1cblx0fV0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG5cdC5jb25maWcoW1wiJHJvdXRlUHJvdmlkZXJcIiAsZnVuY3Rpb24gKCRyb3V0ZVByb3ZpZGVyKSB7XG5cdFx0JHJvdXRlUHJvdmlkZXJcblx0XHRcdC53aGVuKCcvJyAsIHtjb250cm9sbGVyOiAnUG9zdHNDdHJsJywgdGVtcGxhdGVVcmw6ICdwb3N0cy5odG1sJ30pXG5cdFx0XHQud2hlbignL3JlZ2lzdGVyJyAsIHtjb250cm9sbGVyOiAnUmVnaXN0ZXJDdHJsJywgdGVtcGxhdGVVcmw6ICdyZWdpc3Rlci5odG1sJ30pXG5cdFx0XHQud2hlbignL2xvZ2luJyAsIHtjb250cm9sbGVyOiAnTG9naW5DdHJsJywgdGVtcGxhdGVVcmw6ICdsb2dpbi5odG1sJ30pXG5cdFx0XHQud2hlbignL2xvZ291dCcgLCB7Y29udHJvbGxlcjogJ0xvZ2luQ3RybCcsIHRlbXBsYXRlVXJsOiAnbG9nb3V0Lmh0bWwnfSlcblx0XHRcdC53aGVuKCcvcG9zdC86c2x1ZycgLCB7Y29udHJvbGxlcjogJ1NpbmdsZVBvc3RDdHJsJywgdGVtcGxhdGVVcmw6ICdzaW5nbGVQb3N0Lmh0bWwnfSlcblx0XHRcdC53aGVuKCcvcG9zdC9pZC86aWQnICwge2NvbnRyb2xsZXI6ICdTaW5nbGVQb3N0Q3RybCcsIHRlbXBsYXRlVXJsOiAnc2luZ2xlUG9zdC5odG1sJ30pXG5cdH1dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuY29udHJvbGxlcignU2luZ2xlUG9zdEN0cmwnLCBbXCIkc2NvcGVcIiAsIFwiJGh0dHBcIiwgXCJQb3N0c1NlcnZpY2VcIiwgXCIkcm91dGVQYXJhbXNcIiwgXCIkcm91dGVcIiwgXCIkbG9jYXRpb25cIiAsIGZ1bmN0aW9uICgkc2NvcGUsICRodHRwLCBQb3N0c1NlcnZpY2UsICRyb3V0ZVBhcmFtcywgJHJvdXRlLCAkbG9jYXRpb24pIHtcblxuXHRcdHZhciBwb3N0X3NsdWcgPSAkcm91dGVQYXJhbXMuc2x1Zztcblx0XHR2YXIgcG9zdF9pZCA9ICRyb3V0ZVBhcmFtcy5pZDtcblxuXHRcdCRzY29wZS4kb24oJyR2aWV3Q29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCl7XG5cdFx0XHQvL3RoZSBwYWdlIGlzIHJlYWR5XG5cdFx0fSk7XG5cdFxuXHRcdGlmIChwb3N0X3NsdWcpIHtcblx0XHRcdFBvc3RzU2VydmljZS5zaW5nbGVfc2x1Zyh7XG5cdFx0XHRcdHNsdWc6IHBvc3Rfc2x1Z1xuXHRcdFx0fSlcblx0XHRcdC5zdWNjZXNzKGZ1bmN0aW9uIChwb3N0KSB7XG5cdFx0XHRcdCRzY29wZS5wb3N0ID0gcG9zdDtcblx0XHRcdH0pXG5cdFx0fVxuXHRcdGVsc2Uge1xuXHRcdFx0UG9zdHNTZXJ2aWNlLnNpbmdsZV9pZCh7XG5cdFx0XHRcdGlkOiBwb3N0X2lkXG5cdFx0XHR9KVx0XHRcblx0XHRcdC5zdWNjZXNzKGZ1bmN0aW9uIChwb3N0KSB7XG5cdFx0XHRcdCRzY29wZS5wb3N0ID0gcG9zdDtcblx0XHRcdH0pXG5cdFx0fVx0XHRcdFx0XG5cblx0fV0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG5cdC5zZXJ2aWNlKCdVc2VyU3ZjJywgW1wiJGh0dHBcIiwgZnVuY3Rpb24oJGh0dHApIHtcblx0XHR2YXIgc3ZjID0gdGhpcztcblx0XHRzdmMuZ2V0VXNlciA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdCRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXSA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW5cblx0XHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcnMnKVxuXHRcdFx0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBcdFx0XHRyZXR1cm4gcmVzcG9uc2VcbiAgICBcdFx0fSlcblx0XHR9XG5cdFx0c3ZjLmxvZ2luID0gZnVuY3Rpb24gKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuXHRcdFx0cmV0dXJuICRodHRwLnBvc3QoJy9hcGkvc2Vzc2lvbnMnLCB7XG5cdFx0XHRcdHVzZXJuYW1lOiB1c2VybmFtZSwgcGFzc3dvcmQ6IHBhc3N3b3JkXG5cdFx0XHR9KVxuXHRcdFx0LnRoZW4oZnVuY3Rpb24gKHZhbCkge1xuXHRcdFx0XHR3aW5kb3cubG9jYWxTdG9yYWdlLnRva2VuID0gdmFsLmRhdGE7XG5cdFx0XHRcdCRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXSA9IHZhbC5kYXRhXG5cdFx0XHRcdHJldHVybiBzdmMuZ2V0VXNlcigpO1xuXHRcdFx0fSlcblx0XHR9XG5cdFx0c3ZjLnJlZ2lzdGVyID0gZnVuY3Rpb24gKHVzZXJuYW1lLCBwYXNzd29yZCwgcGFzc3dvcmRfY29uZmlybSkge1xuXHRcdFx0cmV0dXJuICRodHRwLnBvc3QoJy9hcGkvdXNlcnMnLCB7XG5cdFx0XHRcdHVzZXJuYW1lOiB1c2VybmFtZSwgcGFzc3dvcmQ6IHBhc3N3b3JkXG5cdFx0XHR9KVxuXHRcdFx0LnRoZW4oZnVuY3Rpb24gKHZhbCkge1xuXHRcdFx0XHRyZXR1cm4gc3ZjLmxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZClcblx0XHRcdFx0XHQudGhlbihmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0d2luZG93LmxvY2F0aW9uLmhyZWY9ICcvJztcdFxuXHRcdFx0XHRcdH0pXG5cdFx0XHR9KVxuXHRcdH1cblx0XHRzdmMubG9nb3V0ID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0d2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCd0b2tlbicpO1xuXHRcdFx0d2luZG93LmxvY2F0aW9uLmhyZWY9ICcvJztcblx0XHR9XG5cdH1dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLnJ1bihbXCIkcm9vdFNjb3BlXCIsIFwiJHRpbWVvdXRcIiAsIFwiJHdpbmRvd1wiICwgZnVuY3Rpb24gKCRyb290U2NvcGUsICR0aW1lb3V0LCAkd2luZG93KSB7XG5cdFxuXHQoZnVuY3Rpb24gY29ubmVjdCgpe1xuXHRcdC8vQ3JlYXRlIGEgd2Vic29ja2V0IGNvbm5lY3Rpb24gd2l0aCB0aGUgc2VydmVyXG5cdFx0dmFyIGhvc3QgPSBcIndzOi8vXCIgKyAkd2luZG93LmxvY2F0aW9uLmhvc3Rcblx0XHQgIFxuXHRcdHZhciBjb25uZWN0aW9uID0gbmV3IFdlYlNvY2tldChob3N0KVxuXG5cdFx0Y29ubmVjdGlvbi5vbm9wZW4gPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHQvL2NvbnNvbGUubG9nKCdXZWJzb2NrZXQgY29ubmVjdGVkJylcblx0XHR9XG5cblxuXHRcdGNvbm5lY3Rpb24ub25jbG9zZSA9IGZ1bmN0aW9uIChlKSB7XG5cdFx0XHQvL2NvbnNvbGUubG9nKCdXZWJzb2NrZXQgY2xvc2VkLiBUcnlpbmcgdG8gcmVjb25uZWN0Li4uJylcblx0XHRcdCR0aW1lb3V0KGNvbm5lY3QsIDEwKjEwMDApO1xuXHRcdH0gXG5cblx0XHRjb25uZWN0aW9uLm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChlKSB7XG5cdFx0XHQvL2NvbnNvbGUubG9nKGUpO1xuXHRcdFx0dmFyIG1lc3NhZ2UgPSBKU09OLnBhcnNlKGUuZGF0YSk7XG5cdFx0XHRcblx0XHRcdHZhciBuYW1lID0gJ3dzOicgKyBtZXNzYWdlLnRvcGljO1xuXHRcdFx0dmFyIGRhdGEgPSBtZXNzYWdlLmRhdGE7XG5cdFx0XHQvL2NvbnNvbGUubG9nKFwiYnJvYWRjYXN0aW5nOiBcIik7XG5cblx0XHRcdCRyb290U2NvcGUuJGJyb2FkY2FzdChuYW1lLCBkYXRhKTtcblx0XHR9XG5cdH0pKClcbn1dKSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==