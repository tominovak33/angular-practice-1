angular.module("app",["ngRoute","ngAnimate"]),angular.module("app").controller("ApplicationCtrl",["$scope","$rootScope","UserSvc",function(e,t,n){e.baseUrl=location.host,window.localStorage.token&&n.getUser().then(function(t){e.$emit("userLoggedIn",t.data)}),e.$on("userLoggedIn",function(t,n){e.currentUser=n})}]).filter("output_html",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("startFrom",function(){return function(e,t){return e?(t=+t,e.slice(t)):[]}}),angular.module("app").controller("LoginCtrl",["$scope","UserSvc",function(e,t){e.login=function(n,o){t.login(n,o).then(function(t){e.$emit("userLoggedIn",t.data),window.location.href="#/"},function(t){e.loginValidation="Incorrect username & password combination"})},e.logout=function(){t.logout()}}]),angular.module("app").controller("PostsCtrl",["$scope","$http","PostsService","filterFilter",function(e,t,n,o){e.baseUrl=location.host,e.bodyLengthLimit=250,e.posts=[],e.addPost=function(){var t=CKEDITOR.instances.editor1.getData(),o=e.urlDate(),r=e.slugify(e.postTitle),s=o+r;t&&n.send({body:t,title:e.postTitle,slug:s}).success(function(t){e.postBody=null,CKEDITOR.instances.editor1.setData(""),e.postTitle=null})},e.init_ckedit=function(){CKEDITOR.replace("editor1")},e.$on("ws:new_post",function(t,n){n=n[0],e.$apply(function(){e.posts.unshift(n),e.paginate()})}),e.$on("$viewContentLoaded",function(){}),e.currentPage=1,e.postsPerPage=5,e.prevPage=function(){e.currentPage>1&&e.currentPage--},e.nextPage=function(){e.currentPage<e.posts.length/e.postsPerPage&&e.currentPage++},e.setPage=function(t){e.currentPage=t},e.range=function(e){return new Array(e)},e.$watch("search",function(t){e.filteredPosts=o(e.posts,t),e.paginate(e.filteredPosts.length)},!0),e.paginate=function(t){e.numberOfPages=Math.ceil(t>0?t/e.postsPerPage:e.posts.length/e.postsPerPage)},e.urlDate=function(e){if(void 0===e)var t=new Date;else var t=new Date(e);var n=t.getDate(),o=t.getMonth()+1,r=t.getFullYear(),s=String(r)+"-"+String(o)+"-"+String(n)+"-";return s},e.slugify=function(e){var t=e.toLowerCase();return t=t.replace(/\s+/g,"_"),t=t.replace(/\?/g,""),t=t.replace(/\&/g,""),t=t.replace(/\=/g,"")},n.get().success(function(t){e.posts=t,e.paginate(e.posts.length)})}]),angular.module("app").service("PostsService",["$http",function(e){this.get=function(){return e.get("/api/posts")},this.send=function(t){return e.post("/api/posts",t)},this.single_slug=function(t){return e.get("/api/posts",{params:{post_slug:t.slug}})},this.single_id=function(t){return e.get("/api/posts",{params:{post_id:t.id}})},this.user_posts=function(t){return e.get("/api/posts",{params:{_author:t._author}})}}]),angular.module("app").controller("ProfileCtrl",["$scope","$http","UserSvc","PostsService","$routeParams","$route","$location",function(e,t,n,o,r,s,i){e.baseUrl=location.host;var a=r.username;e["new"]={},n.profile(a).success(function(t){e.user_profile=t,o.user_posts({_author:e.user_profile._id}).success(function(t){e.user_posts=t,e.paginate(e.user_posts.length)})}),e.checkLogin=function(){window.localStorage.token&&n.getUser().then(function(t){e.currentUser=t.data,e.user_profile._id==e.currentUser._id&&(e.pageOwner=!0)})},e.currentUser=[],e.checkLogin(),e.$on("$viewContentLoaded",function(){}),e.user_posts=[],e.currentPage=1,e.postsPerPage=5,e.prevPage=function(){e.currentPage>1&&e.currentPage--},e.nextPage=function(){e.currentPage<e.user_posts.length/e.postsPerPage&&e.currentPage++},e.setPage=function(t){e.currentPage=t},e.range=function(e){return new Array(e)},e.paginate=function(t){e.numberOfPages=Math.ceil(t>0?t/e.postsPerPage:e.user_posts.length/e.postsPerPage)},e.range=function(e){return new Array(e)},e.pageOwner,e.saveProfile=function(){var t={_id:e.currentUser._id};for(var o in e["new"])e["new"].hasOwnProperty(o)&&""!=e["new"][o]&&(t[o]=e["new"][o]);n.profileUpdate(t).success(function(e){console.log(e)})}}]),angular.module("app").controller("RegisterCtrl",["$scope","UserSvc",function(e,t){e.register=function(n,o,r){return o!=r?void(e.validationMessage="Your passwords did not match."):void t.register(n,o)}}]),angular.module("app").config(["$routeProvider",function(e){e.when("/",{controller:"PostsCtrl",templateUrl:"posts.html"}).when("/register",{controller:"RegisterCtrl",templateUrl:"register.html"}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html"}).when("/logout",{controller:"LoginCtrl",templateUrl:"logout.html"}).when("/post/:slug",{controller:"SinglePostCtrl",templateUrl:"singlePost.html"}).when("/post/id/:id",{controller:"SinglePostCtrl",templateUrl:"singlePost.html"}).when("/user/:username",{controller:"ProfileCtrl",templateUrl:"user.html"}).when("/user/:username/edit",{controller:"ProfileCtrl",templateUrl:"userEdit.html"})}]),angular.module("app").controller("SinglePostCtrl",["$scope","$http","PostsService","$routeParams","$route","$location",function(e,t,n,o,r,s){var i=o.slug,a=o.id;e.$on("$viewContentLoaded",function(){}),i?n.single_slug({slug:i}).success(function(t){e.post=t}):n.single_id({id:a}).success(function(t){e.post=t})}]),angular.module("app").service("UserSvc",["$http",function(e){var t=this;t.getUser=function(){return e.defaults.headers.common["X-Auth"]=window.localStorage.token,e.get("/api/users").then(function(e){return e})},t.login=function(n,o){return e.post("/api/sessions",{username:n,password:o}).then(function(n){return window.localStorage.token=n.data,e.defaults.headers.common["X-Auth"]=n.data,t.getUser()})},t.register=function(n,o,r){return e.post("/api/users",{username:n,password:o}).then(function(e){return t.login(n,o).then(function(){window.location.href="/"})})},t.logout=function(){window.localStorage.removeItem("token"),window.location.href="/"},t.profile=function(t){return e.get("/api/users/profile",{params:{username:t}})},t.profileUpdate=function(t){return e.post("/api/users/profile",t)}}]),angular.module("app").run(["$rootScope","$timeout","$window",function(e,t,n){var o=10;!function r(){o+=o;var s="ws://"+n.location.host,i=new WebSocket(s);i.onopen=function(){},i.onclose=function(e){console.log("Websocket connection closed. Attempting to recconnect in "+o+" seconds"),t(r,1e3*o)},i.onmessage=function(t){var n=JSON.parse(t.data),o="ws:"+n.topic,r=n.data;e.$broadcast(o,r)}}()}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uQ3RybC5qcyIsImxvZ2luQ3J0bC5qcyIsInBvc3RzQ3RybC5qcyIsInBvc3RzU2VydmljZS5qcyIsInByb2ZpbGVDdHJsLmpzIiwicmVnaXN0cmF0aW9uQ3RybC5qcyIsInJvdXRlcy5qcyIsInNpbmdsZVBvc3RzQ3RybC5qcyIsInVzZXJTZXJ2aWNlLmpzIiwid2Vic29ja2V0cy5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiY29udHJvbGxlciIsIiRzY29wZSIsIiRyb290U2NvcGUiLCJVc2VyU3ZjIiwiYmFzZVVybCIsImxvY2F0aW9uIiwiaG9zdCIsIndpbmRvdyIsImxvY2FsU3RvcmFnZSIsInRva2VuIiwiZ2V0VXNlciIsInRoZW4iLCJyZXNwb25zZSIsIiRlbWl0IiwiZGF0YSIsIiRvbiIsImV2ZW50IiwidXNlciIsImN1cnJlbnRVc2VyIiwiZmlsdGVyIiwiJHNjZSIsInZhbCIsInRydXN0QXNIdG1sIiwiaW5wdXQiLCJzdGFydCIsInNsaWNlIiwibG9naW4iLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwiaHJlZiIsImVycm9yIiwibG9naW5WYWxpZGF0aW9uIiwibG9nb3V0IiwiJGh0dHAiLCJQb3N0c1NlcnZpY2UiLCJmaWx0ZXJGaWx0ZXIiLCJib2R5TGVuZ3RoTGltaXQiLCJwb3N0cyIsImFkZFBvc3QiLCJja2VkaXRvcl9jb250ZW50IiwiQ0tFRElUT1IiLCJpbnN0YW5jZXMiLCJlZGl0b3IxIiwiZ2V0RGF0YSIsImRhdGVfc2x1ZyIsInVybERhdGUiLCJ0aXRsZV9zbHVnIiwic2x1Z2lmeSIsInBvc3RUaXRsZSIsInNsdWciLCJzZW5kIiwiYm9keSIsInRpdGxlIiwic3VjY2VzcyIsInBvc3QiLCJwb3N0Qm9keSIsInNldERhdGEiLCJpbml0X2NrZWRpdCIsInJlcGxhY2UiLCJfIiwiJGFwcGx5IiwidW5zaGlmdCIsInBhZ2luYXRlIiwiY3VycmVudFBhZ2UiLCJwb3N0c1BlclBhZ2UiLCJwcmV2UGFnZSIsIm5leHRQYWdlIiwibGVuZ3RoIiwic2V0UGFnZSIsInBhZ2VfbnVtYmVyIiwicmFuZ2UiLCJuIiwiQXJyYXkiLCIkd2F0Y2giLCJ0ZXJtIiwiZmlsdGVyZWRQb3N0cyIsIm51bWJlcl9vZl9pdGVtcyIsIm51bWJlck9mUGFnZXMiLCJNYXRoIiwiY2VpbCIsInRpbWUiLCJ1bmRlZmluZWQiLCJkYXRlIiwiRGF0ZSIsImRheSIsImdldERhdGUiLCJtb250aCIsImdldE1vbnRoIiwieWVhciIsImdldEZ1bGxZZWFyIiwidXJsX2RhdGUiLCJTdHJpbmciLCJzdHJpbmciLCJ0b0xvd2VyQ2FzZSIsImdldCIsInNlcnZpY2UiLCJ0aGlzIiwic2luZ2xlX3NsdWciLCJwYXJhbWV0ZXJzIiwicGFyYW1zIiwicG9zdF9zbHVnIiwic2luZ2xlX2lkIiwicG9zdF9pZCIsImlkIiwidXNlcl9wb3N0cyIsIl9hdXRob3IiLCIkcm91dGVQYXJhbXMiLCIkcm91dGUiLCIkbG9jYXRpb24iLCJwcm9maWxlIiwidXNlcl9wcm9maWxlIiwiX2lkIiwiY2hlY2tMb2dpbiIsInBhZ2VPd25lciIsInNhdmVQcm9maWxlIiwicHJvZmlsZV9kZXRhaWxzIiwia2V5IiwiaGFzT3duUHJvcGVydHkiLCJwcm9maWxlVXBkYXRlIiwiY29uc29sZSIsImxvZyIsInJlZ2lzdGVyIiwicGFzc3dvcmRfY29uZmlybSIsInZhbGlkYXRpb25NZXNzYWdlIiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJzdmMiLCJkZWZhdWx0cyIsImhlYWRlcnMiLCJjb21tb24iLCJyZW1vdmVJdGVtIiwicnVuIiwiJHRpbWVvdXQiLCIkd2luZG93IiwicmVjb25uZWN0X2RlbGF5IiwiY29ubmVjdCIsImNvbm5lY3Rpb24iLCJXZWJTb2NrZXQiLCJvbm9wZW4iLCJvbmNsb3NlIiwiZSIsIm9ubWVzc2FnZSIsIm1lc3NhZ2UiLCJKU09OIiwicGFyc2UiLCJuYW1lIiwidG9waWMiLCIkYnJvYWRjYXN0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QUEsV0FBQSxVQUFBLFNBQUFuSSxFQUFBb0ksRUFBQUMsR0FFQSxHQUFBQyxHQUFBLElBRUEsUUFBQUMsS0FFQUQsR0FBQUEsQ0FHQSxJQUFBbEksR0FBQSxRQUFBaUksRUFBQWxJLFNBQUFDLEtBRUFvSSxFQUFBLEdBQUFDLFdBQUFySSxFQUVBb0ksR0FBQUUsT0FBQSxhQUtBRixFQUFBRyxRQUFBLFNBQUFDLEdBQ0F2QixRQUFBQyxJQUFBLDREQUFBZ0IsRUFBQSxZQUVBRixFQUFBRyxFQUFBLElBQUFELElBR0FFLEVBQUFLLFVBQUEsU0FBQUQsR0FFQSxHQUFBRSxHQUFBQyxLQUFBQyxNQUFBSixFQUFBaEksTUFFQXFJLEVBQUEsTUFBQUgsRUFBQUksTUFDQXRJLEVBQUFrSSxFQUFBbEksSUFHQVosR0FBQW1KLFdBQUFGLEVBQUFySSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL1RoaXMgZmlsZSBtdXN0IGJlIHRoZSBmaXJzdCBpbiB0aGUgbGlzdCB0byBiZSBjb25jYXRlbmF0ZWRcbmFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbJ25nUm91dGUnLCAnbmdBbmltYXRlJ10pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG5cdC5jb250cm9sbGVyKCdBcHBsaWNhdGlvbkN0cmwnICwgW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIlVzZXJTdmNcIiwgZnVuY3Rpb24gKCRzY29wZSwgJHJvb3RTY29wZSwgVXNlclN2Yykge1xuXHRcdC8qXG5cdFx0SWYgd2UgaGF2ZSBhIHN0b3JlZCB0b2tlbiwgZ2V0IHRoZSB1c2VyIGluZm9ybWF0aW9uIGZyb20gaXRcblx0XHRhbmQgZW1pdCB0aGUgdXNlciBsb2dnZWRpbiBtZXNzYWdlcyBpbiBvcmRlciB0byBhbGxvdyB0aGUgVUkgdG8gXG5cdFx0aW5kaWNhdGUgdG8gdGhlIHVzZXIgdGhhdCB0aGV5IHdlcmUgbG9nZ2VkIGluXG5cdFx0Ki9cblx0XHQkc2NvcGUuYmFzZVVybCA9IGxvY2F0aW9uLmhvc3Q7XG5cblx0XHRcblx0XHRpZiAod2luZG93LmxvY2FsU3RvcmFnZS50b2tlbikge1xuXHRcdFx0VXNlclN2Yy5nZXRVc2VyKClcblx0XHRcdFx0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKXtcblx0XHRcdFx0XHQkc2NvcGUuJGVtaXQoJ3VzZXJMb2dnZWRJbicsIHJlc3BvbnNlLmRhdGEpO1xuXHRcdFx0XHR9KVxuXHRcdH1cblxuXHRcdCRzY29wZS4kb24oJ3VzZXJMb2dnZWRJbicsIGZ1bmN0aW9uKGV2ZW50LCB1c2VyKSB7XG5cdFx0XHQkc2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xuXHRcdH0pXG5cdH1dKVxuXG5cdC5maWx0ZXIoJ291dHB1dF9odG1sJywgW1wiJHNjZVwiLCBmdW5jdGlvbiAoJHNjZSkge1xuXHRcdHJldHVybiBmdW5jdGlvbih2YWwpIHtcblx0ICAgICAgICByZXR1cm4gJHNjZS50cnVzdEFzSHRtbCh2YWwpO1xuXHQgICAgfTtcblx0fV0pXG5cblx0LmZpbHRlcignc3RhcnRGcm9tJywgZnVuY3Rpb24oKSB7XG5cdCAgICByZXR1cm4gZnVuY3Rpb24oaW5wdXQsIHN0YXJ0KSB7XG5cdCAgICAgICAgaWYoaW5wdXQpIHtcblx0ICAgICAgICAgICAgc3RhcnQgPSArc3RhcnQ7IC8vcGFyc2UgdG8gaW50XG5cdCAgICAgICAgICAgIHJldHVybiBpbnB1dC5zbGljZShzdGFydCk7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIHJldHVybiBbXTtcblx0ICAgIH1cblx0fSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG5cdC5jb250cm9sbGVyKCdMb2dpbkN0cmwnICwgW1wiJHNjb3BlXCIgLCBcIlVzZXJTdmNcIiAsIGZ1bmN0aW9uICgkc2NvcGUsIFVzZXJTdmMpIHtcblx0XHQkc2NvcGUubG9naW4gPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkKSB7XG5cdFx0XHRVc2VyU3ZjLmxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZClcblx0XHRcdFx0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKXtcblx0XHRcdFx0XHQkc2NvcGUuJGVtaXQoJ3VzZXJMb2dnZWRJbicsIHJlc3BvbnNlLmRhdGEpO1xuXHRcdFx0XHRcdHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJyMvJ1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRmdW5jdGlvbihlcnJvcil7XG5cdFx0XHRcdCAgJHNjb3BlLmxvZ2luVmFsaWRhdGlvbiA9ICdJbmNvcnJlY3QgdXNlcm5hbWUgJiBwYXNzd29yZCBjb21iaW5hdGlvbic7XG5cdFx0XHRcdH0pXG5cblx0XHR9XG5cblx0XHQkc2NvcGUubG9nb3V0ID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0VXNlclN2Yy5sb2dvdXQoKVxuXHRcdH1cblx0fV0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG5cdC5jb250cm9sbGVyKCdQb3N0c0N0cmwnLCBbXCIkc2NvcGVcIiAsIFwiJGh0dHBcIiwgXCJQb3N0c1NlcnZpY2VcIiwgXCJmaWx0ZXJGaWx0ZXJcIiwgZnVuY3Rpb24gKCRzY29wZSwgJGh0dHAsIFBvc3RzU2VydmljZSwgZmlsdGVyRmlsdGVyKSB7XG5cdFx0JHNjb3BlLmJhc2VVcmwgPSBsb2NhdGlvbi5ob3N0O1xuXHRcdCRzY29wZS5ib2R5TGVuZ3RoTGltaXQgPSAyNTA7XG5cblx0XHQkc2NvcGUucG9zdHMgPSBbXTtcblx0XHQkc2NvcGUuYWRkUG9zdCA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdHZhciBja2VkaXRvcl9jb250ZW50ID0gQ0tFRElUT1IuaW5zdGFuY2VzLmVkaXRvcjEuZ2V0RGF0YSgpO1xuXHRcdFx0dmFyIGRhdGVfc2x1ZyA9ICRzY29wZS51cmxEYXRlKCk7XG5cdFx0XHR2YXIgdGl0bGVfc2x1ZyA9ICRzY29wZS5zbHVnaWZ5KCRzY29wZS5wb3N0VGl0bGUpO1xuXG5cdFx0XHR2YXIgc2x1ZyA9IGRhdGVfc2x1ZyArIHRpdGxlX3NsdWc7XG5cblx0XHRcdGlmIChja2VkaXRvcl9jb250ZW50KSB7XG5cdFx0XHRcdFBvc3RzU2VydmljZS5zZW5kKHtcblx0XHRcdFx0XHRib2R5OiBja2VkaXRvcl9jb250ZW50LFxuXHRcdFx0XHRcdHRpdGxlOiAkc2NvcGUucG9zdFRpdGxlLFxuXHRcdFx0XHRcdHNsdWc6IHNsdWdcblx0XHRcdFx0fSlcblx0XHRcdFx0LnN1Y2Nlc3MoZnVuY3Rpb24gKHBvc3QpIHtcblx0XHRcdFx0XHQvKlxuXHRcdFx0XHRcdC8vUmVtb3ZlZCBhcyB3ZWJzb2NrZXQgYnJvYWRjYXN0IHdvdWxkIGNhdXNlIHRoZSBwb3N0IHRvIGFwcGVhciBkdXBsaWNhdGVkIG9uIHRoZSBicm93c2VyIHRoYXQgaXQgd2FzIHBvc3RlZCBmcm9tIFxuXHRcdFx0XHRcdC8vYXMgYm90aCBvZiB0aGUgZnVuY3Rpb25zIHdvdWxkIGdldCBleGVjdXRlZCBiZWNhdXNlIHRoZSBjbGllbnQgd2hvIHNlbmRzIHRoZSBwb3N0IHdvdWxkIHN0aWxsIHJlY2lldmUgdGhlIHdlYnNvY2tldHMgYnJvYWRjYXN0IGJhY2sgZnJvbSB0aGUgc2VydmVyICBcblx0XHRcdFx0XHQqL1xuXHRcdFx0XHRcdCRzY29wZS5wb3N0Qm9keSA9IG51bGw7XG5cdFx0XHRcdFx0Q0tFRElUT1IuaW5zdGFuY2VzLmVkaXRvcjEuc2V0RGF0YSgnJyk7XG5cdFx0XHRcdFx0JHNjb3BlLnBvc3RUaXRsZSA9IG51bGw7XG5cdFx0XHRcdH0pXG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0JHNjb3BlLmluaXRfY2tlZGl0ID0gZnVuY3Rpb24gKCkge1xuXHRcdCAgICBDS0VESVRPUi5yZXBsYWNlKCdlZGl0b3IxJyk7XG5cdFx0fVxuXG5cdFx0JHNjb3BlLiRvbignd3M6bmV3X3Bvc3QnLCBmdW5jdGlvbihfLCBwb3N0KSB7XG5cdFx0XHRwb3N0ID0gcG9zdFswXTtcblx0XHRcdCRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHQkc2NvcGUucG9zdHMudW5zaGlmdChwb3N0KTtcblx0XHRcdFx0JHNjb3BlLnBhZ2luYXRlKCk7XG5cdFx0XHR9KVxuXHRcdH0pXG5cblx0XHQkc2NvcGUuJG9uKCckdmlld0NvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbigpe1xuXHRcdFx0Ly90aGUgcGFnZSBpcyByZWFkeVxuXHRcdH0pO1xuXG5cdFx0JHNjb3BlLmN1cnJlbnRQYWdlID0gMTtcblx0XHQkc2NvcGUucG9zdHNQZXJQYWdlID0gNTtcblxuXHRcdCRzY29wZS5wcmV2UGFnZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICBpZiAoJHNjb3BlLmN1cnJlbnRQYWdlID4gMSkge1xuXHQgICAgICAgICAgICAkc2NvcGUuY3VycmVudFBhZ2UtLTtcblx0ICAgICAgICB9XG5cdCAgICB9O1xuICAgIFxuXHQgICAgJHNjb3BlLm5leHRQYWdlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIGlmICgkc2NvcGUuY3VycmVudFBhZ2UgPCAkc2NvcGUucG9zdHMubGVuZ3RoLyRzY29wZS5wb3N0c1BlclBhZ2UpIHtcblx0ICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRQYWdlKys7XG5cdCAgICAgICAgfVxuXHQgICAgfTtcblx0ICAgIFxuXHQgICAgJHNjb3BlLnNldFBhZ2UgPSBmdW5jdGlvbiAocGFnZV9udW1iZXIpIHtcblx0ICAgICAgICAkc2NvcGUuY3VycmVudFBhZ2UgPSBwYWdlX251bWJlcjtcblx0ICAgIH07XG5cblx0ICAgIC8vVGhpcyB3YXkgSSBjYW4gZG86ICBcIjxsaSBuZy1yZXBlYXQ9XCJuIGluIHJhbmdlKHBhZ2VzKSB0cmFjayBieSAkaW5kZXhcIj5cIiBhbmQgc28gSSBjYW4gZGlzcGxheSBhcyBtYW55IGl0ZW1zIGFzIHRoZSB2YWx1ZSBvZiBhIG51bWJlciBhcyB0aGlzIHJldHVybnMgYW4gYXJyYXkgb2YgdGhhdCBsZW5naHRcblx0ICAgICRzY29wZS5yYW5nZSA9IGZ1bmN0aW9uKG4pIHtcbiAgICAgICAgXHRyZXR1cm4gbmV3IEFycmF5KG4pO1xuICAgIFx0fTtcblx0ICAgIFxuXHQgICAgLy93YXRjaCB0byBzZWUgaWYgc2VhcmNoaW5nIGFuZCByZXBhZ2luYXRlIGlmIHdlIGFyZVxuXHQgICAgLy90cnVlIGF0IHRoZSBlbmQgIG1hZ2ljYWxseSBtYWtlcyBpdCBzbyB0aGF0IGFzIGVhY2ggZXh0cmEgbGV0dGVyIGlzIGFkZGVkIHRvIHRoZSBzZWFyY2ggd2UgY2FuIHJlcGFnaW5hdGVcblx0ICAgIC8vd2l0aG91dCB0aGUgJ3RydWUnIGl0IG9ubHkgZGlkICB0aGF0XG5cdCAgICAkc2NvcGUuJHdhdGNoKCdzZWFyY2gnLCBmdW5jdGlvbih0ZXJtKSB7XG5cdCAgICAgICAgJHNjb3BlLmZpbHRlcmVkUG9zdHMgPSBmaWx0ZXJGaWx0ZXIoJHNjb3BlLnBvc3RzLCB0ZXJtKTtcblx0ICAgICAgICAkc2NvcGUucGFnaW5hdGUoJHNjb3BlLmZpbHRlcmVkUG9zdHMubGVuZ3RoKTtcblx0ICAgIH0sIHRydWUpO1xuXG5cblx0ICAgICRzY29wZS5wYWdpbmF0ZSA9IGZ1bmN0aW9uKG51bWJlcl9vZl9pdGVtcyl7XG5cdCAgICBcdGlmIChudW1iZXJfb2ZfaXRlbXMgPiAwKSB7XG5cdCAgICAgICAgXHQkc2NvcGUubnVtYmVyT2ZQYWdlcyA9IE1hdGguY2VpbChudW1iZXJfb2ZfaXRlbXMvJHNjb3BlLnBvc3RzUGVyUGFnZSk7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIGVsc2Uge1xuXHQgICAgICAgIFx0JHNjb3BlLm51bWJlck9mUGFnZXMgPSBNYXRoLmNlaWwoJHNjb3BlLnBvc3RzLmxlbmd0aC8kc2NvcGUucG9zdHNQZXJQYWdlKTtcblx0ICAgICAgICB9XG5cdCAgICB9O1xuXG5cdCAgICAkc2NvcGUudXJsRGF0ZSA9IGZ1bmN0aW9uKHRpbWUpIHtcblx0XHRcdGlmICh0aW1lID09PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0dmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdHZhciBkYXRlID0gbmV3IERhdGUodGltZSk7XG5cdFx0XHR9XG5cdFx0ICAgIHZhciBkYXkgPSBkYXRlLmdldERhdGUoKTtcblx0XHQgICAgdmFyIG1vbnRoID0gZGF0ZS5nZXRNb250aCgpKzE7IC8vKzEgYmVjYXVzZSBtb250aHMgYXJlIDAgaW5kZXhlZFxuXHRcdCAgICB2YXIgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcblxuXHRcdCAgICB2YXIgdXJsX2RhdGUgPSAgU3RyaW5nKHllYXIpICsgJy0nICsgU3RyaW5nKG1vbnRoKSArICctJyArIFN0cmluZyhkYXkpICsgJy0nIDtcblxuXHRcdFx0cmV0dXJuIHVybF9kYXRlO1xuXG5cdCAgICB9O1xuXG5cdCAgICAkc2NvcGUuc2x1Z2lmeSA9IGZ1bmN0aW9uKHN0cmluZykge1xuXHQgICAgXHR2YXIgc2x1ZyA9ICBzdHJpbmcudG9Mb3dlckNhc2UoKTtcblx0ICAgIFx0c2x1ZyA9IHNsdWcucmVwbGFjZSgvXFxzKy9nLFwiX1wiKTtcblx0ICAgIFx0c2x1ZyA9IHNsdWcucmVwbGFjZSgvXFw/L2csIFwiXCIpO1xuXHQgICAgXHRzbHVnID0gc2x1Zy5yZXBsYWNlKC9cXCYvZywgXCJcIik7XG5cdCAgICBcdHNsdWcgPSBzbHVnLnJlcGxhY2UoL1xcPS9nLCBcIlwiKTtcblx0ICAgIFx0cmV0dXJuIHNsdWc7XG5cdCAgICB9O1xuXG5cdFBvc3RzU2VydmljZS5nZXQoKVxuXHRcdC5zdWNjZXNzKGZ1bmN0aW9uIChwb3N0cykge1xuXHRcdFx0JHNjb3BlLnBvc3RzID0gcG9zdHM7XG5cdFx0XHQvL2NvbnNvbGUubG9nKHBvc3RzKTsgLy9Mb2cgYWxsIHRoZSBwb3N0cyByZWNpZXZlZCBmcm9tIHRoZSBzZXJ2ZXJcblx0XHRcdCRzY29wZS5wYWdpbmF0ZSgkc2NvcGUucG9zdHMubGVuZ3RoKTtcblx0XHR9KVxuXG5cdH1dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuc2VydmljZSgnUG9zdHNTZXJ2aWNlJywgW1wiJGh0dHBcIiAsIGZ1bmN0aW9uICgkaHR0cCkge1xuXHRcdHRoaXMuZ2V0ID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9wb3N0cycpO1xuXHRcdH1cblx0XHR0aGlzLnNlbmQgPSBmdW5jdGlvbiAocG9zdCkge1xuXHRcdFx0cmV0dXJuICRodHRwLnBvc3QoJy9hcGkvcG9zdHMnLCBwb3N0KTtcblx0XHR9XG5cdFx0dGhpcy5zaW5nbGVfc2x1ZyA9IGZ1bmN0aW9uIChwYXJhbWV0ZXJzKSB7XG5cdFx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3Bvc3RzJywgeyBwYXJhbXM6IHtwb3N0X3NsdWc6IHBhcmFtZXRlcnMuc2x1Z30gfSApO1xuXHRcdH1cblx0XHR0aGlzLnNpbmdsZV9pZCA9IGZ1bmN0aW9uIChwYXJhbWV0ZXJzKSB7XG5cdFx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3Bvc3RzJywgeyBwYXJhbXM6IHtwb3N0X2lkOiBwYXJhbWV0ZXJzLmlkfSB9ICk7XG5cdFx0fVxuXHRcdHRoaXMudXNlcl9wb3N0cyA9IGZ1bmN0aW9uIChwYXJhbWV0ZXJzKSB7XG5cdFx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3Bvc3RzJywgeyBwYXJhbXM6IHtfYXV0aG9yOiBwYXJhbWV0ZXJzLl9hdXRob3J9IH0gKTtcblx0XHR9XG5cdH1dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuY29udHJvbGxlcignUHJvZmlsZUN0cmwnLCBbXCIkc2NvcGVcIiAsIFwiJGh0dHBcIiwgXCJVc2VyU3ZjXCIsIFwiUG9zdHNTZXJ2aWNlXCIgLCBcIiRyb3V0ZVBhcmFtc1wiLCBcIiRyb3V0ZVwiLCBcIiRsb2NhdGlvblwiICwgZnVuY3Rpb24gKCRzY29wZSwgJGh0dHAsIFVzZXJTdmMsIFBvc3RzU2VydmljZSwgJHJvdXRlUGFyYW1zLCAkcm91dGUsICRsb2NhdGlvbikge1xuXG5cdFx0JHNjb3BlLmJhc2VVcmwgPSBsb2NhdGlvbi5ob3N0O1xuXHRcdHZhciB1c2VybmFtZSA9ICRyb3V0ZVBhcmFtcy51c2VybmFtZTtcblx0XHQkc2NvcGUubmV3ICA9IHt9O1xuXG5cdFx0VXNlclN2Yy5wcm9maWxlICh1c2VybmFtZSlcblx0XHRcdC5zdWNjZXNzKGZ1bmN0aW9uICh1c2VyX3Byb2ZpbGUpIHtcblx0XHRcdFx0JHNjb3BlLnVzZXJfcHJvZmlsZSA9IHVzZXJfcHJvZmlsZTtcblx0XHRcdFx0UG9zdHNTZXJ2aWNlLnVzZXJfcG9zdHMgKHtcblx0XHRcdFx0XHRfYXV0aG9yOiAkc2NvcGUudXNlcl9wcm9maWxlLl9pZFxuXHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5zdWNjZXNzKGZ1bmN0aW9uICh1c2VyX3Bvc3RzKSB7XG5cdFx0XHRcdFx0XHQkc2NvcGUudXNlcl9wb3N0cyA9IHVzZXJfcG9zdHM7XG5cdFx0XHRcdFx0XHQkc2NvcGUucGFnaW5hdGUoJHNjb3BlLnVzZXJfcG9zdHMubGVuZ3RoKTtcblx0XHRcdFx0XHR9KVxuXHRcdFx0fSlcblxuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0LyBDaGVjayBjdXJyZW50bHkgbG9nZ2VkIGluIHVzZXIgXG5cdFx0Ly0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHQkc2NvcGUuY2hlY2tMb2dpbiA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0Ly9pcyBhbnlvbmUgbG9nZ2VkIGluXG5cdFx0ICBcdGlmICh3aW5kb3cubG9jYWxTdG9yYWdlLnRva2VuKSB7XG5cdFx0XHQgIFx0Ly9nZXQgY3VycmVudCB1c2VyXG5cdFx0XHQgIFx0VXNlclN2Yy5nZXRVc2VyKClcblx0XHRcdFx0XHQudGhlbihmdW5jdGlvbiAocmVzcG9uc2Upe1xuXHRcdFx0XHRcdFx0JHNjb3BlLmN1cnJlbnRVc2VyID0gcmVzcG9uc2UuZGF0YTtcblx0XHRcdFx0XHRcdFx0Ly9pcyB0aGUgdXNlciB0aGUgc2FtZSBhcyB0aGUgdXNlciB3aG8ncyBwYWdlIHRoaXMgaXNcblx0XHRcdFx0XHRcdFx0aWYgKCRzY29wZS51c2VyX3Byb2ZpbGUuX2lkID09ICRzY29wZS5jdXJyZW50VXNlci5faWQgKSB7XG5cdFx0XHRcdFx0XHRcdFx0JHNjb3BlLnBhZ2VPd25lciA9IHRydWU7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KVxuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHQvIEVuZCB1c2VyIGNoZWNrIFxuXHRcdC8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0JHNjb3BlLmN1cnJlbnRVc2VyID0gW107XG5cblx0XHQkc2NvcGUuY2hlY2tMb2dpbigpO1xuXG5cdFx0JHNjb3BlLiRvbignJHZpZXdDb250ZW50TG9hZGVkJywgZnVuY3Rpb24oKXtcblx0XHRcdC8vdGhlIHBhZ2UgaXMgcmVhZHlcblx0XHR9KTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8gUGFnaW5hdGlvbiBcblx0XHQvLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdCRzY29wZS51c2VyX3Bvc3RzID0gW107XG5cblx0XHQkc2NvcGUuY3VycmVudFBhZ2UgPSAxO1xuXHRcdCRzY29wZS5wb3N0c1BlclBhZ2UgPSA1O1xuXG5cdFx0JHNjb3BlLnByZXZQYWdlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIGlmICgkc2NvcGUuY3VycmVudFBhZ2UgPiAxKSB7XG5cdCAgICAgICAgICAgICRzY29wZS5jdXJyZW50UGFnZS0tO1xuXHQgICAgICAgIH1cblx0ICAgIH07XG4gICAgXG5cdCAgICAkc2NvcGUubmV4dFBhZ2UgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgaWYgKCRzY29wZS5jdXJyZW50UGFnZSA8ICRzY29wZS51c2VyX3Bvc3RzLmxlbmd0aC8kc2NvcGUucG9zdHNQZXJQYWdlKSB7XG5cdCAgICAgICAgICAgICRzY29wZS5jdXJyZW50UGFnZSsrO1xuXHQgICAgICAgIH1cblx0ICAgIH07XG5cdCAgICBcblx0ICAgICRzY29wZS5zZXRQYWdlID0gZnVuY3Rpb24gKHBhZ2VfbnVtYmVyKSB7XG5cdCAgICAgICAgJHNjb3BlLmN1cnJlbnRQYWdlID0gcGFnZV9udW1iZXI7XG5cdCAgICB9O1xuXG5cdCAgICAvL1RoaXMgd2F5IEkgY2FuIGRvOiAgXCI8bGkgbmctcmVwZWF0PVwibiBpbiByYW5nZShwYWdlcykgdHJhY2sgYnkgJGluZGV4XCI+XCIgYW5kIHNvIEkgY2FuIGRpc3BsYXkgYXMgbWFueSBpdGVtcyBhcyB0aGUgdmFsdWUgb2YgYSBudW1iZXIgYXMgdGhpcyByZXR1cm5zIGFuIGFycmF5IG9mIHRoYXQgbGVuZ2h0XG5cdCAgICAkc2NvcGUucmFuZ2UgPSBmdW5jdGlvbihuKSB7XG4gICAgICAgIFx0cmV0dXJuIG5ldyBBcnJheShuKTtcbiAgICBcdH07XG5cdCAgICBcblxuXHRcdCRzY29wZS5wYWdpbmF0ZSA9IGZ1bmN0aW9uKG51bWJlcl9vZl9pdGVtcyl7XG5cdCAgICBcdGlmIChudW1iZXJfb2ZfaXRlbXMgPiAwKSB7XG5cdCAgICAgICAgXHQkc2NvcGUubnVtYmVyT2ZQYWdlcyA9IE1hdGguY2VpbChudW1iZXJfb2ZfaXRlbXMvJHNjb3BlLnBvc3RzUGVyUGFnZSk7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIGVsc2Uge1xuXHQgICAgICAgIFx0JHNjb3BlLm51bWJlck9mUGFnZXMgPSBNYXRoLmNlaWwoJHNjb3BlLnVzZXJfcG9zdHMubGVuZ3RoLyRzY29wZS5wb3N0c1BlclBhZ2UpO1xuXHQgICAgICAgIH1cblx0ICAgIH07XG5cblxuXG5cdCAgICAvL1RoaXMgd2F5IEkgY2FuIGRvOiAgXCI8bGkgbmctcmVwZWF0PVwibiBpbiByYW5nZShwYWdlcykgdHJhY2sgYnkgJGluZGV4XCI+XCIgYW5kIHNvIEkgY2FuIGRpc3BsYXkgYXMgbWFueSBpdGVtcyBhcyB0aGUgdmFsdWUgb2YgYSBudW1iZXIgYXMgdGhpcyByZXR1cm5zIGFuIGFycmF5IG9mIHRoYXQgbGVuZ2h0XG5cdCAgICAkc2NvcGUucmFuZ2UgPSBmdW5jdGlvbihuKSB7XG4gICAgICAgIFx0cmV0dXJuIG5ldyBBcnJheShuKTtcbiAgICBcdH07XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHQvIEVuZCBQYWdpbmF0aW9uIFxuXHRcdC8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8gUHJvZmlsZSBlZGl0IG9wdGlvbnMgXG5cdFx0Ly0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0aWYgKCRzY29wZS5wYWdlT3duZXIpIHtcblxuXHRcdH1cblxuXHRcdCRzY29wZS5zYXZlUHJvZmlsZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0dmFyIHByb2ZpbGVfZGV0YWlscyA9IHtcblx0XHRcdFx0X2lkIDogJHNjb3BlLmN1cnJlbnRVc2VyLl9pZFxuXHRcdFx0fTtcblxuXHRcdFx0Zm9yICh2YXIga2V5IGluICRzY29wZS5uZXcpIHtcblx0XHRcdCAgaWYgKCRzY29wZS5uZXcuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuXHRcdFx0ICAgIC8vYWxlcnQoa2V5ICsgXCIgLT4gXCIgKyAkc2NvcGUubmV3W2tleV0pO1xuXHRcdFx0ICAgIGlmICgkc2NvcGUubmV3W2tleV0gIT0gJycpIHtcblx0XHRcdCAgICBcdHByb2ZpbGVfZGV0YWlsc1trZXldID0gJHNjb3BlLm5ld1trZXldO1xuXHRcdFx0ICAgIH1cblx0XHRcdCAgfVxuXHRcdFx0fVxuXG5cdFx0XHQvL2NvbnNvbGUubG9nKCRzY29wZS5uZXcpO1xuXHRcdFx0Ly9jb25zb2xlLmxvZyhwcm9maWxlX2RldGFpbHMpO1xuXG5cdFx0XHRVc2VyU3ZjLnByb2ZpbGVVcGRhdGUocHJvZmlsZV9kZXRhaWxzKVxuXHRcdFx0XHQuc3VjY2VzcyhmdW5jdGlvbiAodXNlcikge1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKHVzZXIpO1xuXHRcdFx0XHR9KVxuXHRcdH1cblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8gRW5kIHByb2ZpbGUgZWRpdCBvcHRpb25zIFxuXHRcdC8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcblxuXHR9XSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcblx0LmNvbnRyb2xsZXIoJ1JlZ2lzdGVyQ3RybCcgLCBbXCIkc2NvcGVcIiAsIFwiVXNlclN2Y1wiICwgZnVuY3Rpb24gKCRzY29wZSwgVXNlclN2Yykge1xuXHRcdCRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQsIHBhc3N3b3JkX2NvbmZpcm0pIHtcblx0XHRcdGlmIChwYXNzd29yZCAhPSBwYXNzd29yZF9jb25maXJtKSB7XG5cdFx0XHRcdCRzY29wZS52YWxpZGF0aW9uTWVzc2FnZSA9ICdZb3VyIHBhc3N3b3JkcyBkaWQgbm90IG1hdGNoLic7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdFVzZXJTdmMucmVnaXN0ZXIodXNlcm5hbWUsIHBhc3N3b3JkKVxuXHRcdH1cblx0fV0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG5cdC5jb25maWcoW1wiJHJvdXRlUHJvdmlkZXJcIiAsZnVuY3Rpb24gKCRyb3V0ZVByb3ZpZGVyKSB7XG5cdFx0JHJvdXRlUHJvdmlkZXJcblx0XHRcdC53aGVuKCcvJyAsIHtjb250cm9sbGVyOiAnUG9zdHNDdHJsJywgdGVtcGxhdGVVcmw6ICdwb3N0cy5odG1sJ30pXG5cdFx0XHQud2hlbignL3JlZ2lzdGVyJyAsIHtjb250cm9sbGVyOiAnUmVnaXN0ZXJDdHJsJywgdGVtcGxhdGVVcmw6ICdyZWdpc3Rlci5odG1sJ30pXG5cdFx0XHQud2hlbignL2xvZ2luJyAsIHtjb250cm9sbGVyOiAnTG9naW5DdHJsJywgdGVtcGxhdGVVcmw6ICdsb2dpbi5odG1sJ30pXG5cdFx0XHQud2hlbignL2xvZ291dCcgLCB7Y29udHJvbGxlcjogJ0xvZ2luQ3RybCcsIHRlbXBsYXRlVXJsOiAnbG9nb3V0Lmh0bWwnfSlcblx0XHRcdC53aGVuKCcvcG9zdC86c2x1ZycgLCB7Y29udHJvbGxlcjogJ1NpbmdsZVBvc3RDdHJsJywgdGVtcGxhdGVVcmw6ICdzaW5nbGVQb3N0Lmh0bWwnfSlcblx0XHRcdC53aGVuKCcvcG9zdC9pZC86aWQnICwge2NvbnRyb2xsZXI6ICdTaW5nbGVQb3N0Q3RybCcsIHRlbXBsYXRlVXJsOiAnc2luZ2xlUG9zdC5odG1sJ30pXG5cdFx0XHQud2hlbignL3VzZXIvOnVzZXJuYW1lJyAsIHtjb250cm9sbGVyOiAnUHJvZmlsZUN0cmwnLCB0ZW1wbGF0ZVVybDogJ3VzZXIuaHRtbCd9KVxuXHRcdFx0LndoZW4oJy91c2VyLzp1c2VybmFtZS9lZGl0JyAsIHtjb250cm9sbGVyOiAnUHJvZmlsZUN0cmwnLCB0ZW1wbGF0ZVVybDogJ3VzZXJFZGl0Lmh0bWwnfSlcblx0fV0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG5cdC5jb250cm9sbGVyKCdTaW5nbGVQb3N0Q3RybCcsIFtcIiRzY29wZVwiICwgXCIkaHR0cFwiLCBcIlBvc3RzU2VydmljZVwiLCBcIiRyb3V0ZVBhcmFtc1wiLCBcIiRyb3V0ZVwiLCBcIiRsb2NhdGlvblwiICwgZnVuY3Rpb24gKCRzY29wZSwgJGh0dHAsIFBvc3RzU2VydmljZSwgJHJvdXRlUGFyYW1zLCAkcm91dGUsICRsb2NhdGlvbikge1xuXG5cdFx0dmFyIHBvc3Rfc2x1ZyA9ICRyb3V0ZVBhcmFtcy5zbHVnO1xuXHRcdHZhciBwb3N0X2lkID0gJHJvdXRlUGFyYW1zLmlkO1xuXG5cdFx0JHNjb3BlLiRvbignJHZpZXdDb250ZW50TG9hZGVkJywgZnVuY3Rpb24oKXtcblx0XHRcdC8vdGhlIHBhZ2UgaXMgcmVhZHlcblx0XHR9KTtcblx0XG5cdFx0aWYgKHBvc3Rfc2x1Zykge1xuXHRcdFx0UG9zdHNTZXJ2aWNlLnNpbmdsZV9zbHVnKHtcblx0XHRcdFx0c2x1ZzogcG9zdF9zbHVnXG5cdFx0XHR9KVxuXHRcdFx0LnN1Y2Nlc3MoZnVuY3Rpb24gKHBvc3QpIHtcblx0XHRcdFx0JHNjb3BlLnBvc3QgPSBwb3N0O1xuXHRcdFx0fSlcblx0XHR9XG5cdFx0ZWxzZSB7XG5cdFx0XHRQb3N0c1NlcnZpY2Uuc2luZ2xlX2lkKHtcblx0XHRcdFx0aWQ6IHBvc3RfaWRcblx0XHRcdH0pXHRcdFxuXHRcdFx0LnN1Y2Nlc3MoZnVuY3Rpb24gKHBvc3QpIHtcblx0XHRcdFx0JHNjb3BlLnBvc3QgPSBwb3N0O1xuXHRcdFx0fSlcblx0XHR9XHRcdFx0XHRcblxuXHR9XSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcblx0LnNlcnZpY2UoJ1VzZXJTdmMnLCBbXCIkaHR0cFwiLCBmdW5jdGlvbigkaHR0cCkge1xuXHRcdHZhciBzdmMgPSB0aGlzO1xuXHRcdHN2Yy5nZXRVc2VyID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0JGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddID0gd2luZG93LmxvY2FsU3RvcmFnZS50b2tlblxuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS91c2VycycpXG5cdFx0XHQudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIFx0XHRcdHJldHVybiByZXNwb25zZVxuICAgIFx0XHR9KVxuXHRcdH1cblx0XHRzdmMubG9naW4gPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkKSB7XG5cdFx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9zZXNzaW9ucycsIHtcblx0XHRcdFx0dXNlcm5hbWU6IHVzZXJuYW1lLCBwYXNzd29yZDogcGFzc3dvcmRcblx0XHRcdH0pXG5cdFx0XHQudGhlbihmdW5jdGlvbiAodmFsKSB7XG5cdFx0XHRcdHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW4gPSB2YWwuZGF0YTtcblx0XHRcdFx0JGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddID0gdmFsLmRhdGFcblx0XHRcdFx0cmV0dXJuIHN2Yy5nZXRVc2VyKCk7XG5cdFx0XHR9KVxuXHRcdH1cblx0XHRzdmMucmVnaXN0ZXIgPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkLCBwYXNzd29yZF9jb25maXJtKSB7XG5cdFx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS91c2VycycsIHtcblx0XHRcdFx0dXNlcm5hbWU6IHVzZXJuYW1lLCBwYXNzd29yZDogcGFzc3dvcmRcblx0XHRcdH0pXG5cdFx0XHQudGhlbihmdW5jdGlvbiAodmFsKSB7XG5cdFx0XHRcdHJldHVybiBzdmMubG9naW4odXNlcm5hbWUsIHBhc3N3b3JkKVxuXHRcdFx0XHRcdC50aGVuKGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHR3aW5kb3cubG9jYXRpb24uaHJlZj0gJy8nO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHR9KVxuXHRcdH1cblx0XHRzdmMubG9nb3V0ID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0d2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCd0b2tlbicpO1xuXHRcdFx0d2luZG93LmxvY2F0aW9uLmhyZWY9ICcvJztcblx0XHR9XG5cdFx0c3ZjLnByb2ZpbGUgPSBmdW5jdGlvbiAodXNlcm5hbWUpIHtcblx0XHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcnMvcHJvZmlsZScsIHsgcGFyYW1zOiB7dXNlcm5hbWU6IHVzZXJuYW1lfSB9KVxuXHRcdH1cblx0XHRzdmMucHJvZmlsZVVwZGF0ZSA9IGZ1bmN0aW9uIChwcm9maWxlKSB7XG5cdFx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS91c2Vycy9wcm9maWxlJywgcHJvZmlsZSApXG5cdFx0fVxuXHR9XSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbi5ydW4oW1wiJHJvb3RTY29wZVwiLCBcIiR0aW1lb3V0XCIgLCBcIiR3aW5kb3dcIiAsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkdGltZW91dCwgJHdpbmRvdykge1xuXG5cdHZhciByZWNvbm5lY3RfZGVsYXkgPSAxMDtcblx0XG5cdChmdW5jdGlvbiBjb25uZWN0KCl7XG5cdFx0Ly9pbmNyZW1lbnQgdGhlIHJlY29ubmVjdCBkZWxheSB0aW1lZXJcblx0XHRyZWNvbm5lY3RfZGVsYXkgKz0gcmVjb25uZWN0X2RlbGF5O1xuXG5cdFx0Ly9DcmVhdGUgYSB3ZWJzb2NrZXQgY29ubmVjdGlvbiB3aXRoIHRoZSBzZXJ2ZXJcblx0XHR2YXIgaG9zdCA9IFwid3M6Ly9cIiArICR3aW5kb3cubG9jYXRpb24uaG9zdFxuXHRcdCAgXG5cdFx0dmFyIGNvbm5lY3Rpb24gPSBuZXcgV2ViU29ja2V0KGhvc3QpXG5cblx0XHRjb25uZWN0aW9uLm9ub3BlbiA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdC8vY29uc29sZS5sb2coJ1dlYnNvY2tldCBjb25uZWN0ZWQnKVxuXHRcdH1cblxuXG5cdFx0Y29ubmVjdGlvbi5vbmNsb3NlID0gZnVuY3Rpb24gKGUpIHtcblx0XHRcdGNvbnNvbGUubG9nKCdXZWJzb2NrZXQgY29ubmVjdGlvbiBjbG9zZWQuIEF0dGVtcHRpbmcgdG8gcmVjY29ubmVjdCBpbiAnICsgcmVjb25uZWN0X2RlbGF5ICsgJyBzZWNvbmRzJyApXG5cblx0XHRcdCR0aW1lb3V0KGNvbm5lY3QsIHJlY29ubmVjdF9kZWxheSoxMDAwKTtcblx0XHR9IFxuXG5cdFx0Y29ubmVjdGlvbi5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkge1xuXHRcdFx0Ly9jb25zb2xlLmxvZyhlKTtcblx0XHRcdHZhciBtZXNzYWdlID0gSlNPTi5wYXJzZShlLmRhdGEpO1xuXHRcdFx0XG5cdFx0XHR2YXIgbmFtZSA9ICd3czonICsgbWVzc2FnZS50b3BpYztcblx0XHRcdHZhciBkYXRhID0gbWVzc2FnZS5kYXRhO1xuXHRcdFx0Ly9jb25zb2xlLmxvZyhcImJyb2FkY2FzdGluZzogXCIpO1xuXG5cdFx0XHQkcm9vdFNjb3BlLiRicm9hZGNhc3QobmFtZSwgZGF0YSk7XG5cdFx0fVxuXHR9KSgpXG59XSkiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=