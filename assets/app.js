angular.module("app",["ngRoute","ngAnimate"]),angular.module("app").controller("ApplicationCtrl",["$scope","$rootScope","UserSvc",function(t,e,n){window.localStorage.token&&n.getUser().then(function(e){t.$emit("userLoggedIn",e.data)}),t.$on("userLoggedIn",function(e,n){t.currentUser=n})}]).filter("output_html",["$sce",function(t){return function(e){return t.trustAsHtml(e)}}]).filter("startFrom",function(){return function(t,e){return t?(e=+e,t.slice(e)):[]}}),angular.module("app").controller("LoginCtrl",["$scope","UserSvc",function(t,e){t.login=function(n,o){e.login(n,o).then(function(e){t.$emit("userLoggedIn",e.data),window.location.href="#/"},function(e){t.loginValidation="Incorrect username & password combination"})},t.logout=function(){e.logout()}}]),angular.module("app").controller("PostsCtrl",["$scope","$http","PostsService","filterFilter",function(t,e,n,o){t.baseUrl=location.host,t.bodyLengthLimit=250,t.posts=[],t.addPost=function(){var e=CKEDITOR.instances.editor1.getData(),o=t.urlDate(),r=t.slugify(t.postTitle),s=o+r;e&&n.send({body:e,title:t.postTitle,slug:s}).success(function(e){t.postBody=null,CKEDITOR.instances.editor1.setData(""),t.postTitle=null})},t.init_ckedit=function(){CKEDITOR.replace("editor1")},t.$on("ws:new_post",function(e,n){n=n[0],t.$apply(function(){t.posts.unshift(n),t.paginate()})}),t.$on("$viewContentLoaded",function(){}),t.currentPage=1,t.postsPerPage=5,t.prevPage=function(){t.currentPage>1&&t.currentPage--},t.nextPage=function(){t.currentPage<t.posts.length/t.postsPerPage&&t.currentPage++},t.setPage=function(e){t.currentPage=e},t.range=function(t){return new Array(t)},t.$watch("search",function(e){t.filteredPosts=o(t.posts,e),t.paginate(t.filteredPosts.length)},!0),t.paginate=function(e){t.numberOfPages=Math.ceil(e>0?e/t.postsPerPage:t.posts.length/t.postsPerPage)},t.urlDate=function(t){if(void 0===t)var e=new Date;else var e=new Date(t);var n=e.getDate(),o=e.getMonth()+1,r=e.getFullYear(),s=String(r)+"-"+String(o)+"-"+String(n)+"-";return s},t.slugify=function(t){var e=t.toLowerCase();return e=e.replace(/\s+/g,"_"),e=e.replace(/\?/g,""),e=e.replace(/\&/g,""),e=e.replace(/\=/g,"")},n.get().success(function(e){t.posts=e,t.paginate(t.posts.length)})}]),angular.module("app").service("PostsService",["$http",function(t){this.get=function(){return t.get("/api/posts")},this.send=function(e){return t.post("/api/posts",e)},this.single_slug=function(e){return t.get("/api/posts",{params:{post_slug:e.slug}})},this.single_id=function(e){return t.get("/api/posts",{params:{post_id:e.id}})},this.user_posts=function(e){return t.get("/api/posts",{params:{_author:e._author}})}}]),angular.module("app").controller("ProfileCtrl",["$scope","$http","UserSvc","PostsService","$routeParams","$route","$location",function(t,e,n,o,r,s,i){t.baseUrl=location.host;var a=r.username;n.profile(a).success(function(e){t.user_profile=e,o.user_posts({_author:t.user_profile._id}).success(function(e){t.user_posts=e,t.paginate(t.user_posts.length)})}),t.checkLogin=function(){window.localStorage.token&&n.getUser().then(function(e){t.currentUser=e.data,t.user_profile._id==t.currentUser._id&&(t.pageOwner=!0)})},t.currentUser=[],t.checkLogin(),t.$on("$viewContentLoaded",function(){}),t.user_posts=[],t.currentPage=1,t.postsPerPage=5,t.prevPage=function(){t.currentPage>1&&t.currentPage--},t.nextPage=function(){t.currentPage<t.user_posts.length/t.postsPerPage&&t.currentPage++},t.setPage=function(e){t.currentPage=e},t.range=function(t){return new Array(t)},t.paginate=function(e){t.numberOfPages=Math.ceil(e>0?e/t.postsPerPage:t.user_posts.length/t.postsPerPage)},t.range=function(t){return new Array(t)},t.pageOwner}]),angular.module("app").controller("RegisterCtrl",["$scope","UserSvc",function(t,e){t.register=function(n,o,r){return o!=r?void(t.validationMessage="Your passwords did not match."):void e.register(n,o)}}]),angular.module("app").config(["$routeProvider",function(t){t.when("/",{controller:"PostsCtrl",templateUrl:"posts.html"}).when("/register",{controller:"RegisterCtrl",templateUrl:"register.html"}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html"}).when("/logout",{controller:"LoginCtrl",templateUrl:"logout.html"}).when("/post/:slug",{controller:"SinglePostCtrl",templateUrl:"singlePost.html"}).when("/post/id/:id",{controller:"SinglePostCtrl",templateUrl:"singlePost.html"}).when("/user/:username",{controller:"ProfileCtrl",templateUrl:"user.html"})}]),angular.module("app").controller("SinglePostCtrl",["$scope","$http","PostsService","$routeParams","$route","$location",function(t,e,n,o,r,s){var i=o.slug,a=o.id;t.$on("$viewContentLoaded",function(){}),i?n.single_slug({slug:i}).success(function(e){t.post=e}):n.single_id({id:a}).success(function(e){t.post=e})}]),angular.module("app").service("UserSvc",["$http",function(t){var e=this;e.getUser=function(){return t.defaults.headers.common["X-Auth"]=window.localStorage.token,t.get("/api/users").then(function(t){return t})},e.login=function(n,o){return t.post("/api/sessions",{username:n,password:o}).then(function(n){return window.localStorage.token=n.data,t.defaults.headers.common["X-Auth"]=n.data,e.getUser()})},e.register=function(n,o,r){return t.post("/api/users",{username:n,password:o}).then(function(t){return e.login(n,o).then(function(){window.location.href="/"})})},e.logout=function(){window.localStorage.removeItem("token"),window.location.href="/"},e.profile=function(e){return t.get("/api/users/profile",{params:{username:e}})}}]),angular.module("app").run(["$rootScope","$timeout","$window",function(t,e,n){!function o(){var r="ws://"+n.location.host,s=new WebSocket(r);s.onopen=function(){},s.onclose=function(t){e(o,1e4)},s.onmessage=function(e){var n=JSON.parse(e.data),o="ws:"+n.topic,r=n.data;t.$broadcast(o,r)}}()}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uQ3RybC5qcyIsImxvZ2luQ3J0bC5qcyIsInBvc3RzQ3RybC5qcyIsInBvc3RzU2VydmljZS5qcyIsInByb2ZpbGVDdHJsLmpzIiwicmVnaXN0cmF0aW9uQ3RybC5qcyIsInJvdXRlcy5qcyIsInNpbmdsZVBvc3RzQ3RybC5qcyIsInVzZXJTZXJ2aWNlLmpzIiwid2Vic29ja2V0cy5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiY29udHJvbGxlciIsIiRzY29wZSIsIiRyb290U2NvcGUiLCJVc2VyU3ZjIiwid2luZG93IiwibG9jYWxTdG9yYWdlIiwidG9rZW4iLCJnZXRVc2VyIiwidGhlbiIsInJlc3BvbnNlIiwiJGVtaXQiLCJkYXRhIiwiJG9uIiwiZXZlbnQiLCJ1c2VyIiwiY3VycmVudFVzZXIiLCJmaWx0ZXIiLCIkc2NlIiwidmFsIiwidHJ1c3RBc0h0bWwiLCJpbnB1dCIsInN0YXJ0Iiwic2xpY2UiLCJsb2dpbiIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJsb2NhdGlvbiIsImhyZWYiLCJlcnJvciIsImxvZ2luVmFsaWRhdGlvbiIsImxvZ291dCIsIiRodHRwIiwiUG9zdHNTZXJ2aWNlIiwiZmlsdGVyRmlsdGVyIiwiYmFzZVVybCIsImhvc3QiLCJib2R5TGVuZ3RoTGltaXQiLCJwb3N0cyIsImFkZFBvc3QiLCJja2VkaXRvcl9jb250ZW50IiwiQ0tFRElUT1IiLCJpbnN0YW5jZXMiLCJlZGl0b3IxIiwiZ2V0RGF0YSIsImRhdGVfc2x1ZyIsInVybERhdGUiLCJ0aXRsZV9zbHVnIiwic2x1Z2lmeSIsInBvc3RUaXRsZSIsInNsdWciLCJzZW5kIiwiYm9keSIsInRpdGxlIiwic3VjY2VzcyIsInBvc3QiLCJwb3N0Qm9keSIsInNldERhdGEiLCJpbml0X2NrZWRpdCIsInJlcGxhY2UiLCJfIiwiJGFwcGx5IiwidW5zaGlmdCIsInBhZ2luYXRlIiwiY3VycmVudFBhZ2UiLCJwb3N0c1BlclBhZ2UiLCJwcmV2UGFnZSIsIm5leHRQYWdlIiwibGVuZ3RoIiwic2V0UGFnZSIsInBhZ2VfbnVtYmVyIiwicmFuZ2UiLCJuIiwiQXJyYXkiLCIkd2F0Y2giLCJ0ZXJtIiwiZmlsdGVyZWRQb3N0cyIsIm51bWJlcl9vZl9pdGVtcyIsIm51bWJlck9mUGFnZXMiLCJNYXRoIiwiY2VpbCIsInRpbWUiLCJ1bmRlZmluZWQiLCJkYXRlIiwiRGF0ZSIsImRheSIsImdldERhdGUiLCJtb250aCIsImdldE1vbnRoIiwieWVhciIsImdldEZ1bGxZZWFyIiwidXJsX2RhdGUiLCJTdHJpbmciLCJzdHJpbmciLCJ0b0xvd2VyQ2FzZSIsImdldCIsInNlcnZpY2UiLCJ0aGlzIiwic2luZ2xlX3NsdWciLCJwYXJhbWV0ZXJzIiwicGFyYW1zIiwicG9zdF9zbHVnIiwic2luZ2xlX2lkIiwicG9zdF9pZCIsImlkIiwidXNlcl9wb3N0cyIsIl9hdXRob3IiLCIkcm91dGVQYXJhbXMiLCIkcm91dGUiLCIkbG9jYXRpb24iLCJwcm9maWxlIiwidXNlcl9wcm9maWxlIiwiX2lkIiwiY2hlY2tMb2dpbiIsInBhZ2VPd25lciIsInJlZ2lzdGVyIiwicGFzc3dvcmRfY29uZmlybSIsInZhbGlkYXRpb25NZXNzYWdlIiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJzdmMiLCJkZWZhdWx0cyIsImhlYWRlcnMiLCJjb21tb24iLCJyZW1vdmVJdGVtIiwicnVuIiwiJHRpbWVvdXQiLCIkd2luZG93IiwiY29ubmVjdCIsImNvbm5lY3Rpb24iLCJXZWJTb2NrZXQiLCJvbm9wZW4iLCJvbmNsb3NlIiwiZSIsIm9ubWVzc2FnZSIsIm1lc3NhZ2UiLCJKU09OIiwicGFyc2UiLCJuYW1lIiwidG9waWMiLCIkYnJvYWRjYXN0Il0sIm1hcHBpbmdzIjoiQUFDQUEsUUFBQUMsT0FBQSxPQUFBLFVBQUEsY0NEQUQsUUFBQUMsT0FBQSxPQUNBQyxXQUFBLG1CQUFBLFNBQUEsYUFBQSxVQUFBLFNBQUFDLEVBQUFDLEVB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R0FHQSxNQUZBZCxRQUFBQyxhQUFBQyxNQUFBWSxFQUFBUCxLQUNBb0IsRUFBQTJGLFNBQUFDLFFBQUFDLE9BQUEsVUFBQTFHLEVBQUFQLEtBQ0E4RyxFQUFBbEgsYUFHQWtILEVBQUFQLFNBQUEsU0FBQTFGLEVBQUFDLEVBQUEwRixHQUNBLE1BQUFwRixHQUFBdUIsS0FBQSxjQUNBOUIsU0FBQUEsRUFBQUMsU0FBQUEsSUFFQWpCLEtBQUEsU0FBQVUsR0FDQSxNQUFBdUcsR0FBQWxHLE1BQUFDLEVBQUFDLEdBQ0FqQixLQUFBLFdBQ0FKLE9BQUFzQixTQUFBQyxLQUFBLFNBSUE4RixFQUFBM0YsT0FBQSxXQUNBMUIsT0FBQUMsYUFBQXdILFdBQUEsU0FDQXpILE9BQUFzQixTQUFBQyxLQUFBLEtBRUE4RixFQUFBWixRQUFBLFNBQUFyRixHQUNBLE1BQUFPLEdBQUErRCxJQUFBLHNCQUFBSyxRQUFBM0UsU0FBQUEsU0NwQ0ExQixRQUFBQyxPQUFBLE9BQ0ErSCxLQUFBLGFBQUEsV0FBQSxVQUFBLFNBQUE1SCxFQUFBNkgsRUFBQUMsSUFFQSxRQUFBQyxLQUVBLEdBQUE5RixHQUFBLFFBQUE2RixFQUFBdEcsU0FBQVMsS0FFQStGLEVBQUEsR0FBQUMsV0FBQWhHLEVBRUErRixHQUFBRSxPQUFBLGFBS0FGLEVBQUFHLFFBQUEsU0FBQUMsR0FFQVAsRUFBQUUsRUFBQSxNQUdBQyxFQUFBSyxVQUFBLFNBQUFELEdBRUEsR0FBQUUsR0FBQUMsS0FBQUMsTUFBQUosRUFBQTNILE1BRUFnSSxFQUFBLE1BQUFILEVBQUFJLE1BQ0FqSSxFQUFBNkgsRUFBQTdILElBR0FULEdBQUEySSxXQUFBRixFQUFBaEkiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy9UaGlzIGZpbGUgbXVzdCBiZSB0aGUgZmlyc3QgaW4gdGhlIGxpc3QgdG8gYmUgY29uY2F0ZW5hdGVkXG5hbmd1bGFyLm1vZHVsZSgnYXBwJywgWyduZ1JvdXRlJywgJ25nQW5pbWF0ZSddKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuY29udHJvbGxlcignQXBwbGljYXRpb25DdHJsJyAsIFtcIiRzY29wZVwiLCBcIiRyb290U2NvcGVcIiwgXCJVc2VyU3ZjXCIsIGZ1bmN0aW9uICgkc2NvcGUsICRyb290U2NvcGUsIFVzZXJTdmMpIHtcblx0XHQvKlxuXHRcdElmIHdlIGhhdmUgYSBzdG9yZWQgdG9rZW4sIGdldCB0aGUgdXNlciBpbmZvcm1hdGlvbiBmcm9tIGl0XG5cdFx0YW5kIGVtaXQgdGhlIHVzZXIgbG9nZ2VkaW4gbWVzc2FnZXMgaW4gb3JkZXIgdG8gYWxsb3cgdGhlIFVJIHRvIFxuXHRcdGluZGljYXRlIHRvIHRoZSB1c2VyIHRoYXQgdGhleSB3ZXJlIGxvZ2dlZCBpblxuXHRcdCovXG5cdFx0XG5cdFx0aWYgKHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW4pIHtcblx0XHRcdFVzZXJTdmMuZ2V0VXNlcigpXG5cdFx0XHRcdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSl7XG5cdFx0XHRcdFx0JHNjb3BlLiRlbWl0KCd1c2VyTG9nZ2VkSW4nLCByZXNwb25zZS5kYXRhKTtcblx0XHRcdFx0fSlcblx0XHR9XG5cblx0XHQkc2NvcGUuJG9uKCd1c2VyTG9nZ2VkSW4nLCBmdW5jdGlvbihldmVudCwgdXNlcikge1xuXHRcdFx0JHNjb3BlLmN1cnJlbnRVc2VyID0gdXNlcjtcblx0XHR9KVxuXHR9XSlcblxuXHQuZmlsdGVyKCdvdXRwdXRfaHRtbCcsIFtcIiRzY2VcIiwgZnVuY3Rpb24gKCRzY2UpIHtcblx0XHRyZXR1cm4gZnVuY3Rpb24odmFsKSB7XG5cdCAgICAgICAgcmV0dXJuICRzY2UudHJ1c3RBc0h0bWwodmFsKTtcblx0ICAgIH07XG5cdH1dKVxuXG5cdC5maWx0ZXIoJ3N0YXJ0RnJvbScsIGZ1bmN0aW9uKCkge1xuXHQgICAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0LCBzdGFydCkge1xuXHQgICAgICAgIGlmKGlucHV0KSB7XG5cdCAgICAgICAgICAgIHN0YXJ0ID0gK3N0YXJ0OyAvL3BhcnNlIHRvIGludFxuXHQgICAgICAgICAgICByZXR1cm4gaW5wdXQuc2xpY2Uoc3RhcnQpO1xuXHQgICAgICAgIH1cblx0ICAgICAgICByZXR1cm4gW107XG5cdCAgICB9XG5cdH0pOyIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuY29udHJvbGxlcignTG9naW5DdHJsJyAsIFtcIiRzY29wZVwiICwgXCJVc2VyU3ZjXCIgLCBmdW5jdGlvbiAoJHNjb3BlLCBVc2VyU3ZjKSB7XG5cdFx0JHNjb3BlLmxvZ2luID0gZnVuY3Rpb24gKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuXHRcdFx0VXNlclN2Yy5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXG5cdFx0XHRcdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSl7XG5cdFx0XHRcdFx0JHNjb3BlLiRlbWl0KCd1c2VyTG9nZ2VkSW4nLCByZXNwb25zZS5kYXRhKTtcblx0XHRcdFx0XHR3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcjLydcblx0XHRcdFx0fSxcblx0XHRcdFx0ZnVuY3Rpb24oZXJyb3Ipe1xuXHRcdFx0XHQgICRzY29wZS5sb2dpblZhbGlkYXRpb24gPSAnSW5jb3JyZWN0IHVzZXJuYW1lICYgcGFzc3dvcmQgY29tYmluYXRpb24nO1xuXHRcdFx0XHR9KVxuXG5cdFx0fVxuXG5cdFx0JHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdFVzZXJTdmMubG9nb3V0KClcblx0XHR9XG5cdH1dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuY29udHJvbGxlcignUG9zdHNDdHJsJywgW1wiJHNjb3BlXCIgLCBcIiRodHRwXCIsIFwiUG9zdHNTZXJ2aWNlXCIsIFwiZmlsdGVyRmlsdGVyXCIsIGZ1bmN0aW9uICgkc2NvcGUsICRodHRwLCBQb3N0c1NlcnZpY2UsIGZpbHRlckZpbHRlcikge1xuXHRcdCRzY29wZS5iYXNlVXJsID0gbG9jYXRpb24uaG9zdDtcblx0XHQkc2NvcGUuYm9keUxlbmd0aExpbWl0ID0gMjUwO1xuXG5cdFx0JHNjb3BlLnBvc3RzID0gW107XG5cdFx0JHNjb3BlLmFkZFBvc3QgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHR2YXIgY2tlZGl0b3JfY29udGVudCA9IENLRURJVE9SLmluc3RhbmNlcy5lZGl0b3IxLmdldERhdGEoKTtcblx0XHRcdHZhciBkYXRlX3NsdWcgPSAkc2NvcGUudXJsRGF0ZSgpO1xuXHRcdFx0dmFyIHRpdGxlX3NsdWcgPSAkc2NvcGUuc2x1Z2lmeSgkc2NvcGUucG9zdFRpdGxlKTtcblxuXHRcdFx0dmFyIHNsdWcgPSBkYXRlX3NsdWcgKyB0aXRsZV9zbHVnO1xuXG5cdFx0XHRpZiAoY2tlZGl0b3JfY29udGVudCkge1xuXHRcdFx0XHRQb3N0c1NlcnZpY2Uuc2VuZCh7XG5cdFx0XHRcdFx0Ym9keTogY2tlZGl0b3JfY29udGVudCxcblx0XHRcdFx0XHR0aXRsZTogJHNjb3BlLnBvc3RUaXRsZSxcblx0XHRcdFx0XHRzbHVnOiBzbHVnXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5zdWNjZXNzKGZ1bmN0aW9uIChwb3N0KSB7XG5cdFx0XHRcdFx0Lypcblx0XHRcdFx0XHQvL1JlbW92ZWQgYXMgd2Vic29ja2V0IGJyb2FkY2FzdCB3b3VsZCBjYXVzZSB0aGUgcG9zdCB0byBhcHBlYXIgZHVwbGljYXRlZCBvbiB0aGUgYnJvd3NlciB0aGF0IGl0IHdhcyBwb3N0ZWQgZnJvbSBcblx0XHRcdFx0XHQvL2FzIGJvdGggb2YgdGhlIGZ1bmN0aW9ucyB3b3VsZCBnZXQgZXhlY3V0ZWQgYmVjYXVzZSB0aGUgY2xpZW50IHdobyBzZW5kcyB0aGUgcG9zdCB3b3VsZCBzdGlsbCByZWNpZXZlIHRoZSB3ZWJzb2NrZXRzIGJyb2FkY2FzdCBiYWNrIGZyb20gdGhlIHNlcnZlciAgXG5cdFx0XHRcdFx0Ki9cblx0XHRcdFx0XHQkc2NvcGUucG9zdEJvZHkgPSBudWxsO1xuXHRcdFx0XHRcdENLRURJVE9SLmluc3RhbmNlcy5lZGl0b3IxLnNldERhdGEoJycpO1xuXHRcdFx0XHRcdCRzY29wZS5wb3N0VGl0bGUgPSBudWxsO1xuXHRcdFx0XHR9KVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdCRzY29wZS5pbml0X2NrZWRpdCA9IGZ1bmN0aW9uICgpIHtcblx0XHQgICAgQ0tFRElUT1IucmVwbGFjZSgnZWRpdG9yMScpO1xuXHRcdH1cblxuXHRcdCRzY29wZS4kb24oJ3dzOm5ld19wb3N0JywgZnVuY3Rpb24oXywgcG9zdCkge1xuXHRcdFx0cG9zdCA9IHBvc3RbMF07XG5cdFx0XHQkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0JHNjb3BlLnBvc3RzLnVuc2hpZnQocG9zdCk7XG5cdFx0XHRcdCRzY29wZS5wYWdpbmF0ZSgpO1xuXHRcdFx0fSlcblx0XHR9KVxuXG5cdFx0JHNjb3BlLiRvbignJHZpZXdDb250ZW50TG9hZGVkJywgZnVuY3Rpb24oKXtcblx0XHRcdC8vdGhlIHBhZ2UgaXMgcmVhZHlcblx0XHR9KTtcblxuXHRcdCRzY29wZS5jdXJyZW50UGFnZSA9IDE7XG5cdFx0JHNjb3BlLnBvc3RzUGVyUGFnZSA9IDU7XG5cblx0XHQkc2NvcGUucHJldlBhZ2UgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgaWYgKCRzY29wZS5jdXJyZW50UGFnZSA+IDEpIHtcblx0ICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRQYWdlLS07XG5cdCAgICAgICAgfVxuXHQgICAgfTtcbiAgICBcblx0ICAgICRzY29wZS5uZXh0UGFnZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICBpZiAoJHNjb3BlLmN1cnJlbnRQYWdlIDwgJHNjb3BlLnBvc3RzLmxlbmd0aC8kc2NvcGUucG9zdHNQZXJQYWdlKSB7XG5cdCAgICAgICAgICAgICRzY29wZS5jdXJyZW50UGFnZSsrO1xuXHQgICAgICAgIH1cblx0ICAgIH07XG5cdCAgICBcblx0ICAgICRzY29wZS5zZXRQYWdlID0gZnVuY3Rpb24gKHBhZ2VfbnVtYmVyKSB7XG5cdCAgICAgICAgJHNjb3BlLmN1cnJlbnRQYWdlID0gcGFnZV9udW1iZXI7XG5cdCAgICB9O1xuXG5cdCAgICAvL1RoaXMgd2F5IEkgY2FuIGRvOiAgXCI8bGkgbmctcmVwZWF0PVwibiBpbiByYW5nZShwYWdlcykgdHJhY2sgYnkgJGluZGV4XCI+XCIgYW5kIHNvIEkgY2FuIGRpc3BsYXkgYXMgbWFueSBpdGVtcyBhcyB0aGUgdmFsdWUgb2YgYSBudW1iZXIgYXMgdGhpcyByZXR1cm5zIGFuIGFycmF5IG9mIHRoYXQgbGVuZ2h0XG5cdCAgICAkc2NvcGUucmFuZ2UgPSBmdW5jdGlvbihuKSB7XG4gICAgICAgIFx0cmV0dXJuIG5ldyBBcnJheShuKTtcbiAgICBcdH07XG5cdCAgICBcblx0ICAgIC8vd2F0Y2ggdG8gc2VlIGlmIHNlYXJjaGluZyBhbmQgcmVwYWdpbmF0ZSBpZiB3ZSBhcmVcblx0ICAgIC8vdHJ1ZSBhdCB0aGUgZW5kICBtYWdpY2FsbHkgbWFrZXMgaXQgc28gdGhhdCBhcyBlYWNoIGV4dHJhIGxldHRlciBpcyBhZGRlZCB0byB0aGUgc2VhcmNoIHdlIGNhbiByZXBhZ2luYXRlXG5cdCAgICAvL3dpdGhvdXQgdGhlICd0cnVlJyBpdCBvbmx5IGRpZCAgdGhhdFxuXHQgICAgJHNjb3BlLiR3YXRjaCgnc2VhcmNoJywgZnVuY3Rpb24odGVybSkge1xuXHQgICAgICAgICRzY29wZS5maWx0ZXJlZFBvc3RzID0gZmlsdGVyRmlsdGVyKCRzY29wZS5wb3N0cywgdGVybSk7XG5cdCAgICAgICAgJHNjb3BlLnBhZ2luYXRlKCRzY29wZS5maWx0ZXJlZFBvc3RzLmxlbmd0aCk7XG5cdCAgICB9LCB0cnVlKTtcblxuXG5cdCAgICAkc2NvcGUucGFnaW5hdGUgPSBmdW5jdGlvbihudW1iZXJfb2ZfaXRlbXMpe1xuXHQgICAgXHRpZiAobnVtYmVyX29mX2l0ZW1zID4gMCkge1xuXHQgICAgICAgIFx0JHNjb3BlLm51bWJlck9mUGFnZXMgPSBNYXRoLmNlaWwobnVtYmVyX29mX2l0ZW1zLyRzY29wZS5wb3N0c1BlclBhZ2UpO1xuXHQgICAgICAgIH1cblx0ICAgICAgICBlbHNlIHtcblx0ICAgICAgICBcdCRzY29wZS5udW1iZXJPZlBhZ2VzID0gTWF0aC5jZWlsKCRzY29wZS5wb3N0cy5sZW5ndGgvJHNjb3BlLnBvc3RzUGVyUGFnZSk7XG5cdCAgICAgICAgfVxuXHQgICAgfTtcblxuXHQgICAgJHNjb3BlLnVybERhdGUgPSBmdW5jdGlvbih0aW1lKSB7XG5cdFx0XHRpZiAodGltZSA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdHZhciBkYXRlID0gbmV3IERhdGUoKTtcblx0XHRcdH1cblx0XHRcdGVsc2Uge1xuXHRcdFx0XHR2YXIgZGF0ZSA9IG5ldyBEYXRlKHRpbWUpO1xuXHRcdFx0fVxuXHRcdCAgICB2YXIgZGF5ID0gZGF0ZS5nZXREYXRlKCk7XG5cdFx0ICAgIHZhciBtb250aCA9IGRhdGUuZ2V0TW9udGgoKSsxOyAvLysxIGJlY2F1c2UgbW9udGhzIGFyZSAwIGluZGV4ZWRcblx0XHQgICAgdmFyIHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7XG5cblx0XHQgICAgdmFyIHVybF9kYXRlID0gIFN0cmluZyh5ZWFyKSArICctJyArIFN0cmluZyhtb250aCkgKyAnLScgKyBTdHJpbmcoZGF5KSArICctJyA7XG5cblx0XHRcdHJldHVybiB1cmxfZGF0ZTtcblxuXHQgICAgfTtcblxuXHQgICAgJHNjb3BlLnNsdWdpZnkgPSBmdW5jdGlvbihzdHJpbmcpIHtcblx0ICAgIFx0dmFyIHNsdWcgPSAgc3RyaW5nLnRvTG93ZXJDYXNlKCk7XG5cdCAgICBcdHNsdWcgPSBzbHVnLnJlcGxhY2UoL1xccysvZyxcIl9cIik7XG5cdCAgICBcdHNsdWcgPSBzbHVnLnJlcGxhY2UoL1xcPy9nLCBcIlwiKTtcblx0ICAgIFx0c2x1ZyA9IHNsdWcucmVwbGFjZSgvXFwmL2csIFwiXCIpO1xuXHQgICAgXHRzbHVnID0gc2x1Zy5yZXBsYWNlKC9cXD0vZywgXCJcIik7XG5cdCAgICBcdHJldHVybiBzbHVnO1xuXHQgICAgfTtcblxuXHRQb3N0c1NlcnZpY2UuZ2V0KClcblx0XHQuc3VjY2VzcyhmdW5jdGlvbiAocG9zdHMpIHtcblx0XHRcdCRzY29wZS5wb3N0cyA9IHBvc3RzO1xuXHRcdFx0Ly9jb25zb2xlLmxvZyhwb3N0cyk7IC8vTG9nIGFsbCB0aGUgcG9zdHMgcmVjaWV2ZWQgZnJvbSB0aGUgc2VydmVyXG5cdFx0XHQkc2NvcGUucGFnaW5hdGUoJHNjb3BlLnBvc3RzLmxlbmd0aCk7XG5cdFx0fSlcblxuXHR9XSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcblx0LnNlcnZpY2UoJ1Bvc3RzU2VydmljZScsIFtcIiRodHRwXCIgLCBmdW5jdGlvbiAoJGh0dHApIHtcblx0XHR0aGlzLmdldCA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvcG9zdHMnKTtcblx0XHR9XG5cdFx0dGhpcy5zZW5kID0gZnVuY3Rpb24gKHBvc3QpIHtcblx0XHRcdHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Bvc3RzJywgcG9zdCk7XG5cdFx0fVxuXHRcdHRoaXMuc2luZ2xlX3NsdWcgPSBmdW5jdGlvbiAocGFyYW1ldGVycykge1xuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9wb3N0cycsIHsgcGFyYW1zOiB7cG9zdF9zbHVnOiBwYXJhbWV0ZXJzLnNsdWd9IH0gKTtcblx0XHR9XG5cdFx0dGhpcy5zaW5nbGVfaWQgPSBmdW5jdGlvbiAocGFyYW1ldGVycykge1xuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9wb3N0cycsIHsgcGFyYW1zOiB7cG9zdF9pZDogcGFyYW1ldGVycy5pZH0gfSApO1xuXHRcdH1cblx0XHR0aGlzLnVzZXJfcG9zdHMgPSBmdW5jdGlvbiAocGFyYW1ldGVycykge1xuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9wb3N0cycsIHsgcGFyYW1zOiB7X2F1dGhvcjogcGFyYW1ldGVycy5fYXV0aG9yfSB9ICk7XG5cdFx0fVxuXHR9XSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcblx0LmNvbnRyb2xsZXIoJ1Byb2ZpbGVDdHJsJywgW1wiJHNjb3BlXCIgLCBcIiRodHRwXCIsIFwiVXNlclN2Y1wiLCBcIlBvc3RzU2VydmljZVwiICwgXCIkcm91dGVQYXJhbXNcIiwgXCIkcm91dGVcIiwgXCIkbG9jYXRpb25cIiAsIGZ1bmN0aW9uICgkc2NvcGUsICRodHRwLCBVc2VyU3ZjLCBQb3N0c1NlcnZpY2UsICRyb3V0ZVBhcmFtcywgJHJvdXRlLCAkbG9jYXRpb24pIHtcblxuXHRcdCRzY29wZS5iYXNlVXJsID0gbG9jYXRpb24uaG9zdDtcblx0XHR2YXIgdXNlcm5hbWUgPSAkcm91dGVQYXJhbXMudXNlcm5hbWU7XG5cblx0XHRVc2VyU3ZjLnByb2ZpbGUgKHVzZXJuYW1lKVxuXHRcdFx0LnN1Y2Nlc3MoZnVuY3Rpb24gKHVzZXJfcHJvZmlsZSkge1xuXHRcdFx0XHQkc2NvcGUudXNlcl9wcm9maWxlID0gdXNlcl9wcm9maWxlO1xuXHRcdFx0XHRQb3N0c1NlcnZpY2UudXNlcl9wb3N0cyAoe1xuXHRcdFx0XHRcdF9hdXRob3I6ICRzY29wZS51c2VyX3Byb2ZpbGUuX2lkXG5cdFx0XHRcdH0pXG5cdFx0XHRcdFx0LnN1Y2Nlc3MoZnVuY3Rpb24gKHVzZXJfcG9zdHMpIHtcblx0XHRcdFx0XHRcdCRzY29wZS51c2VyX3Bvc3RzID0gdXNlcl9wb3N0cztcblx0XHRcdFx0XHRcdCRzY29wZS5wYWdpbmF0ZSgkc2NvcGUudXNlcl9wb3N0cy5sZW5ndGgpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHR9KVxuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0LyBDaGVjayBjdXJyZW50bHkgbG9nZ2VkIGluIHVzZXIgXG5cdFx0Ly0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHQkc2NvcGUuY2hlY2tMb2dpbiA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0Ly9pcyBhbnlvbmUgbG9nZ2VkIGluXG5cdFx0ICBcdGlmICh3aW5kb3cubG9jYWxTdG9yYWdlLnRva2VuKSB7XG5cdFx0XHQgIFx0Ly9nZXQgY3VycmVudCB1c2VyXG5cdFx0XHQgIFx0VXNlclN2Yy5nZXRVc2VyKClcblx0XHRcdFx0XHQudGhlbihmdW5jdGlvbiAocmVzcG9uc2Upe1xuXHRcdFx0XHRcdFx0JHNjb3BlLmN1cnJlbnRVc2VyID0gcmVzcG9uc2UuZGF0YTtcblx0XHRcdFx0XHRcdFx0Ly9pcyB0aGUgdXNlciB0aGUgc2FtZSBhcyB0aGUgdXNlciB3aG8ncyBwYWdlIHRoaXMgaXNcblx0XHRcdFx0XHRcdFx0aWYgKCRzY29wZS51c2VyX3Byb2ZpbGUuX2lkID09ICRzY29wZS5jdXJyZW50VXNlci5faWQgKSB7XG5cdFx0XHRcdFx0XHRcdFx0JHNjb3BlLnBhZ2VPd25lciA9IHRydWU7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KVxuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHQvIEVuZCB1c2VyIGNoZWNrIFxuXHRcdC8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0JHNjb3BlLmN1cnJlbnRVc2VyID0gW107XG5cblx0XHQkc2NvcGUuY2hlY2tMb2dpbigpO1xuXG5cdFx0JHNjb3BlLiRvbignJHZpZXdDb250ZW50TG9hZGVkJywgZnVuY3Rpb24oKXtcblx0XHRcdC8vdGhlIHBhZ2UgaXMgcmVhZHlcblx0XHR9KTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8gUGFnaW5hdGlvbiBcblx0XHQvLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdCRzY29wZS51c2VyX3Bvc3RzID0gW107XG5cblx0XHQkc2NvcGUuY3VycmVudFBhZ2UgPSAxO1xuXHRcdCRzY29wZS5wb3N0c1BlclBhZ2UgPSA1O1xuXG5cdFx0JHNjb3BlLnByZXZQYWdlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIGlmICgkc2NvcGUuY3VycmVudFBhZ2UgPiAxKSB7XG5cdCAgICAgICAgICAgICRzY29wZS5jdXJyZW50UGFnZS0tO1xuXHQgICAgICAgIH1cblx0ICAgIH07XG4gICAgXG5cdCAgICAkc2NvcGUubmV4dFBhZ2UgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgaWYgKCRzY29wZS5jdXJyZW50UGFnZSA8ICRzY29wZS51c2VyX3Bvc3RzLmxlbmd0aC8kc2NvcGUucG9zdHNQZXJQYWdlKSB7XG5cdCAgICAgICAgICAgICRzY29wZS5jdXJyZW50UGFnZSsrO1xuXHQgICAgICAgIH1cblx0ICAgIH07XG5cdCAgICBcblx0ICAgICRzY29wZS5zZXRQYWdlID0gZnVuY3Rpb24gKHBhZ2VfbnVtYmVyKSB7XG5cdCAgICAgICAgJHNjb3BlLmN1cnJlbnRQYWdlID0gcGFnZV9udW1iZXI7XG5cdCAgICB9O1xuXG5cdCAgICAvL1RoaXMgd2F5IEkgY2FuIGRvOiAgXCI8bGkgbmctcmVwZWF0PVwibiBpbiByYW5nZShwYWdlcykgdHJhY2sgYnkgJGluZGV4XCI+XCIgYW5kIHNvIEkgY2FuIGRpc3BsYXkgYXMgbWFueSBpdGVtcyBhcyB0aGUgdmFsdWUgb2YgYSBudW1iZXIgYXMgdGhpcyByZXR1cm5zIGFuIGFycmF5IG9mIHRoYXQgbGVuZ2h0XG5cdCAgICAkc2NvcGUucmFuZ2UgPSBmdW5jdGlvbihuKSB7XG4gICAgICAgIFx0cmV0dXJuIG5ldyBBcnJheShuKTtcbiAgICBcdH07XG5cdCAgICBcblxuXHRcdCRzY29wZS5wYWdpbmF0ZSA9IGZ1bmN0aW9uKG51bWJlcl9vZl9pdGVtcyl7XG5cdCAgICBcdGlmIChudW1iZXJfb2ZfaXRlbXMgPiAwKSB7XG5cdCAgICAgICAgXHQkc2NvcGUubnVtYmVyT2ZQYWdlcyA9IE1hdGguY2VpbChudW1iZXJfb2ZfaXRlbXMvJHNjb3BlLnBvc3RzUGVyUGFnZSk7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIGVsc2Uge1xuXHQgICAgICAgIFx0JHNjb3BlLm51bWJlck9mUGFnZXMgPSBNYXRoLmNlaWwoJHNjb3BlLnVzZXJfcG9zdHMubGVuZ3RoLyRzY29wZS5wb3N0c1BlclBhZ2UpO1xuXHQgICAgICAgIH1cblx0ICAgIH07XG5cblxuXG5cdCAgICAvL1RoaXMgd2F5IEkgY2FuIGRvOiAgXCI8bGkgbmctcmVwZWF0PVwibiBpbiByYW5nZShwYWdlcykgdHJhY2sgYnkgJGluZGV4XCI+XCIgYW5kIHNvIEkgY2FuIGRpc3BsYXkgYXMgbWFueSBpdGVtcyBhcyB0aGUgdmFsdWUgb2YgYSBudW1iZXIgYXMgdGhpcyByZXR1cm5zIGFuIGFycmF5IG9mIHRoYXQgbGVuZ2h0XG5cdCAgICAkc2NvcGUucmFuZ2UgPSBmdW5jdGlvbihuKSB7XG4gICAgICAgIFx0cmV0dXJuIG5ldyBBcnJheShuKTtcbiAgICBcdH07XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHQvIEVuZCBQYWdpbmF0aW9uIFxuXHRcdC8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8gUHJvZmlsZSBlZGl0IG9wdGlvbnMgXG5cdFx0Ly0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0aWYgKCRzY29wZS5wYWdlT3duZXIpIHtcblxuXHRcdH1cblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8gRW5kIHByb2ZpbGUgZWRpdCBvcHRpb25zIFxuXHRcdC8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcblxuXHR9XSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcblx0LmNvbnRyb2xsZXIoJ1JlZ2lzdGVyQ3RybCcgLCBbXCIkc2NvcGVcIiAsIFwiVXNlclN2Y1wiICwgZnVuY3Rpb24gKCRzY29wZSwgVXNlclN2Yykge1xuXHRcdCRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQsIHBhc3N3b3JkX2NvbmZpcm0pIHtcblx0XHRcdGlmIChwYXNzd29yZCAhPSBwYXNzd29yZF9jb25maXJtKSB7XG5cdFx0XHRcdCRzY29wZS52YWxpZGF0aW9uTWVzc2FnZSA9ICdZb3VyIHBhc3N3b3JkcyBkaWQgbm90IG1hdGNoLic7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdFVzZXJTdmMucmVnaXN0ZXIodXNlcm5hbWUsIHBhc3N3b3JkKVxuXHRcdH1cblx0fV0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG5cdC5jb25maWcoW1wiJHJvdXRlUHJvdmlkZXJcIiAsZnVuY3Rpb24gKCRyb3V0ZVByb3ZpZGVyKSB7XG5cdFx0JHJvdXRlUHJvdmlkZXJcblx0XHRcdC53aGVuKCcvJyAsIHtjb250cm9sbGVyOiAnUG9zdHNDdHJsJywgdGVtcGxhdGVVcmw6ICdwb3N0cy5odG1sJ30pXG5cdFx0XHQud2hlbignL3JlZ2lzdGVyJyAsIHtjb250cm9sbGVyOiAnUmVnaXN0ZXJDdHJsJywgdGVtcGxhdGVVcmw6ICdyZWdpc3Rlci5odG1sJ30pXG5cdFx0XHQud2hlbignL2xvZ2luJyAsIHtjb250cm9sbGVyOiAnTG9naW5DdHJsJywgdGVtcGxhdGVVcmw6ICdsb2dpbi5odG1sJ30pXG5cdFx0XHQud2hlbignL2xvZ291dCcgLCB7Y29udHJvbGxlcjogJ0xvZ2luQ3RybCcsIHRlbXBsYXRlVXJsOiAnbG9nb3V0Lmh0bWwnfSlcblx0XHRcdC53aGVuKCcvcG9zdC86c2x1ZycgLCB7Y29udHJvbGxlcjogJ1NpbmdsZVBvc3RDdHJsJywgdGVtcGxhdGVVcmw6ICdzaW5nbGVQb3N0Lmh0bWwnfSlcblx0XHRcdC53aGVuKCcvcG9zdC9pZC86aWQnICwge2NvbnRyb2xsZXI6ICdTaW5nbGVQb3N0Q3RybCcsIHRlbXBsYXRlVXJsOiAnc2luZ2xlUG9zdC5odG1sJ30pXG5cdFx0XHQud2hlbignL3VzZXIvOnVzZXJuYW1lJyAsIHtjb250cm9sbGVyOiAnUHJvZmlsZUN0cmwnLCB0ZW1wbGF0ZVVybDogJ3VzZXIuaHRtbCd9KVxuXHR9XSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcblx0LmNvbnRyb2xsZXIoJ1NpbmdsZVBvc3RDdHJsJywgW1wiJHNjb3BlXCIgLCBcIiRodHRwXCIsIFwiUG9zdHNTZXJ2aWNlXCIsIFwiJHJvdXRlUGFyYW1zXCIsIFwiJHJvdXRlXCIsIFwiJGxvY2F0aW9uXCIgLCBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgUG9zdHNTZXJ2aWNlLCAkcm91dGVQYXJhbXMsICRyb3V0ZSwgJGxvY2F0aW9uKSB7XG5cblx0XHR2YXIgcG9zdF9zbHVnID0gJHJvdXRlUGFyYW1zLnNsdWc7XG5cdFx0dmFyIHBvc3RfaWQgPSAkcm91dGVQYXJhbXMuaWQ7XG5cblx0XHQkc2NvcGUuJG9uKCckdmlld0NvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbigpe1xuXHRcdFx0Ly90aGUgcGFnZSBpcyByZWFkeVxuXHRcdH0pO1xuXHRcblx0XHRpZiAocG9zdF9zbHVnKSB7XG5cdFx0XHRQb3N0c1NlcnZpY2Uuc2luZ2xlX3NsdWcoe1xuXHRcdFx0XHRzbHVnOiBwb3N0X3NsdWdcblx0XHRcdH0pXG5cdFx0XHQuc3VjY2VzcyhmdW5jdGlvbiAocG9zdCkge1xuXHRcdFx0XHQkc2NvcGUucG9zdCA9IHBvc3Q7XG5cdFx0XHR9KVxuXHRcdH1cblx0XHRlbHNlIHtcblx0XHRcdFBvc3RzU2VydmljZS5zaW5nbGVfaWQoe1xuXHRcdFx0XHRpZDogcG9zdF9pZFxuXHRcdFx0fSlcdFx0XG5cdFx0XHQuc3VjY2VzcyhmdW5jdGlvbiAocG9zdCkge1xuXHRcdFx0XHQkc2NvcGUucG9zdCA9IHBvc3Q7XG5cdFx0XHR9KVxuXHRcdH1cdFx0XHRcdFxuXG5cdH1dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuc2VydmljZSgnVXNlclN2YycsIFtcIiRodHRwXCIsIGZ1bmN0aW9uKCRodHRwKSB7XG5cdFx0dmFyIHN2YyA9IHRoaXM7XG5cdFx0c3ZjLmdldFVzZXIgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHQkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1BdXRoJ10gPSB3aW5kb3cubG9jYWxTdG9yYWdlLnRva2VuXG5cdFx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzJylcblx0XHRcdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgXHRcdFx0cmV0dXJuIHJlc3BvbnNlXG4gICAgXHRcdH0pXG5cdFx0fVxuXHRcdHN2Yy5sb2dpbiA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQpIHtcblx0XHRcdHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Nlc3Npb25zJywge1xuXHRcdFx0XHR1c2VybmFtZTogdXNlcm5hbWUsIHBhc3N3b3JkOiBwYXNzd29yZFxuXHRcdFx0fSlcblx0XHRcdC50aGVuKGZ1bmN0aW9uICh2YWwpIHtcblx0XHRcdFx0d2luZG93LmxvY2FsU3RvcmFnZS50b2tlbiA9IHZhbC5kYXRhO1xuXHRcdFx0XHQkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1BdXRoJ10gPSB2YWwuZGF0YVxuXHRcdFx0XHRyZXR1cm4gc3ZjLmdldFVzZXIoKTtcblx0XHRcdH0pXG5cdFx0fVxuXHRcdHN2Yy5yZWdpc3RlciA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQsIHBhc3N3b3JkX2NvbmZpcm0pIHtcblx0XHRcdHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3VzZXJzJywge1xuXHRcdFx0XHR1c2VybmFtZTogdXNlcm5hbWUsIHBhc3N3b3JkOiBwYXNzd29yZFxuXHRcdFx0fSlcblx0XHRcdC50aGVuKGZ1bmN0aW9uICh2YWwpIHtcblx0XHRcdFx0cmV0dXJuIHN2Yy5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXG5cdFx0XHRcdFx0LnRoZW4oZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRcdHdpbmRvdy5sb2NhdGlvbi5ocmVmPSAnLyc7XG5cdFx0XHRcdFx0fSlcblx0XHRcdH0pXG5cdFx0fVxuXHRcdHN2Yy5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHR3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ3Rva2VuJyk7XG5cdFx0XHR3aW5kb3cubG9jYXRpb24uaHJlZj0gJy8nO1xuXHRcdH1cblx0XHRzdmMucHJvZmlsZSA9IGZ1bmN0aW9uICh1c2VybmFtZSkge1xuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS91c2Vycy9wcm9maWxlJywgeyBwYXJhbXM6IHt1c2VybmFtZTogdXNlcm5hbWV9IH0pXG5cdFx0fVxuXHR9XSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbi5ydW4oW1wiJHJvb3RTY29wZVwiLCBcIiR0aW1lb3V0XCIgLCBcIiR3aW5kb3dcIiAsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkdGltZW91dCwgJHdpbmRvdykge1xuXHRcblx0KGZ1bmN0aW9uIGNvbm5lY3QoKXtcblx0XHQvL0NyZWF0ZSBhIHdlYnNvY2tldCBjb25uZWN0aW9uIHdpdGggdGhlIHNlcnZlclxuXHRcdHZhciBob3N0ID0gXCJ3czovL1wiICsgJHdpbmRvdy5sb2NhdGlvbi5ob3N0XG5cdFx0ICBcblx0XHR2YXIgY29ubmVjdGlvbiA9IG5ldyBXZWJTb2NrZXQoaG9zdClcblxuXHRcdGNvbm5lY3Rpb24ub25vcGVuID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0Ly9jb25zb2xlLmxvZygnV2Vic29ja2V0IGNvbm5lY3RlZCcpXG5cdFx0fVxuXG5cblx0XHRjb25uZWN0aW9uLm9uY2xvc2UgPSBmdW5jdGlvbiAoZSkge1xuXHRcdFx0Ly9jb25zb2xlLmxvZygnV2Vic29ja2V0IGNsb3NlZC4gVHJ5aW5nIHRvIHJlY29ubmVjdC4uLicpXG5cdFx0XHQkdGltZW91dChjb25uZWN0LCAxMCoxMDAwKTtcblx0XHR9IFxuXG5cdFx0Y29ubmVjdGlvbi5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkge1xuXHRcdFx0Ly9jb25zb2xlLmxvZyhlKTtcblx0XHRcdHZhciBtZXNzYWdlID0gSlNPTi5wYXJzZShlLmRhdGEpO1xuXHRcdFx0XG5cdFx0XHR2YXIgbmFtZSA9ICd3czonICsgbWVzc2FnZS50b3BpYztcblx0XHRcdHZhciBkYXRhID0gbWVzc2FnZS5kYXRhO1xuXHRcdFx0Ly9jb25zb2xlLmxvZyhcImJyb2FkY2FzdGluZzogXCIpO1xuXG5cdFx0XHQkcm9vdFNjb3BlLiRicm9hZGNhc3QobmFtZSwgZGF0YSk7XG5cdFx0fVxuXHR9KSgpXG59XSkiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=