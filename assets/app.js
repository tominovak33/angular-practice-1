angular.module("app",["ngRoute","ngAnimate"]),angular.module("app").controller("ApplicationCtrl",["$scope","$rootScope","UserSvc",function(t,e,n){window.localStorage.token&&n.getUser().then(function(e){t.$emit("userLoggedIn",e.data)}),t.$on("userLoggedIn",function(e,n){t.currentUser=n})}]),angular.module("app").controller("LoginCtrl",["$scope","UserSvc",function(t,e){t.login=function(n,o){e.login(n,o).then(function(e){t.$emit("userLoggedIn",e.data),window.location.href="#/"},function(e){t.loginValidation="Incorrect username & password combination"})},t.logout=function(){e.logout()}}]),angular.module("app").controller("PostsCtrl",["$scope","$http","PostsService","filterFilter",function(t,e,n,o){t.posts=[],t.addPost=function(){var e=CKEDITOR.instances.editor1.getData();e&&n.send({body:e,title:t.postTitle}).success(function(e){t.postBody=null,CKEDITOR.instances.editor1.setData(""),t.postTitle=null})},t.init_ckedit=function(){CKEDITOR.replace("editor1")},t.$on("ws:new_post",function(e,n){n=n[0],t.$apply(function(){t.posts.unshift(n),t.paginate()})}),t.$on("$viewContentLoaded",function(){}),t.currentPage=1,t.postsPerPage=5,t.prevPage=function(){t.currentPage>1&&(t.currentPage--,t.paginate())},t.nextPage=function(){t.currentPage<t.posts.length/t.postsPerPage&&(t.currentPage++,t.paginate())},t.setPage=function(e){t.currentPage=e,t.paginate()},t.range=function(t){return new Array(t)},t.paginate=function(){t.pagedPosts=[],t.pages=Math.ceil(t.posts.length/t.postsPerPage),t.numberOfPages=function(){return Math.ceil(t.posts.length/t.postsPerPage)};var e=(t.currentPage-1)*t.postsPerPage,n=e+t.postsPerPage;t.pagedPosts=t.posts.slice(e,n)},t.$watchGroup(["search.$","search._author.username","search.title","search.date",,"search.title"],function(){t.paginate()}),t.currentPage=1,t.postsPerPage=5,t.$watch("search",function(e){t.filteredPosts=o(t.posts,e),t.noOfPages=Math.ceil(t.filteredPosts.length/t.postsPerPage)}),n.get().success(function(e){t.posts=e,t.paginate()})}]).filter("output_html",["$sce",function(t){return function(e){return t.trustAsHtml(e)}}]).filter("startFrom",function(){return function(t,e){return t?(e=+e,t.slice(e)):[]}}),angular.module("app").service("PostsService",["$http",function(t){this.get=function(){return t.get("/api/posts")},this.send=function(e){return t.post("/api/posts",e)}}]),angular.module("app").controller("RegisterCtrl",["$scope","UserSvc",function(t,e){t.register=function(n,o,r){return o!=r?void(t.validationMessage="Your passwords did not match."):void e.register(n,o)}}]),angular.module("app").config(["$routeProvider",function(t){t.when("/",{controller:"PostsCtrl",templateUrl:"posts.html"}).when("/register",{controller:"RegisterCtrl",templateUrl:"register.html"}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html"}).when("/logout",{controller:"LoginCtrl",templateUrl:"logout.html"})}]),angular.module("app").service("UserSvc",["$http",function(t){var e=this;e.getUser=function(){return t.defaults.headers.common["X-Auth"]=window.localStorage.token,t.get("/api/users").then(function(t){return t})},e.login=function(n,o){return t.post("/api/sessions",{username:n,password:o}).then(function(n){return window.localStorage.token=n.data,t.defaults.headers.common["X-Auth"]=n.data,e.getUser()})},e.register=function(n,o,r){return t.post("/api/users",{username:n,password:o}).then(function(t){return e.login(n,o).then(function(){window.location.href="/"})})},e.logout=function(){window.localStorage.removeItem("token"),window.location.href="/"}}]),angular.module("app").run(["$rootScope","$timeout","$window",function(t,e,n){!function o(){var r="ws://"+n.location.host,s=new WebSocket(r);s.onopen=function(){},s.onclose=function(t){e(o,1e4)},s.onmessage=function(e){var n=JSON.parse(e.data),o="ws:"+n.topic,r=n.data;t.$broadcast(o,r)}}()}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uQ3RybC5qcyIsImxvZ2luQ3J0bC5qcyIsInBvc3RzQ3RybC5qcyIsInBvc3RzU2VydmljZS5qcyIsInJlZ2lzdHJhdGlvbkN0cmwuanMiLCJyb3V0ZXMuanMiLCJ1c2VyU2VydmljZS5qcyIsIndlYnNvY2tldHMuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbnRyb2xsZXIiLCIkc2NvcGUiLCIkcm9vdFNjb3BlIiwiVXNlclN2YyIsIndpbmRvdyIsImxvY2FsU3RvcmFnZSIsInRva2VuIiwiZ2V0VXNlciIsInRoZW4iLCJyZXNwb25zZSIsIiRlbWl0IiwiZGF0YSIsIiRvbiIsImV2ZW50IiwidXNlciIsImN1cnJlbnRVc2VyIiwibG9naW4iLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwibG9jYXRpb24iLCJocmVmIiwiZXJyb3IiLCJsb2dpblZhbGlkYXRpb24iLCJsb2dvdXQiLCIkaHR0cCIsIlBvc3RzU2VydmljZSIsImZpbHRlckZpbHRlciIsInBvc3RzIiwiYWRkUG9zdCIsImNrZWRpdG9yX2NvbnRlbnQiLCJDS0VESVRPUiIsImluc3RhbmNlcyIsImVkaXRvcjEiLCJnZXREYXRhIiwic2VuZCIsImJvZHkiLCJ0aXRsZSIsInBvc3RUaXRsZSIsInN1Y2Nlc3MiLCJwb3N0IiwicG9zdEJvZHkiLCJzZXREYXRhIiwiaW5pdF9ja2VkaXQiLCJyZXBsYWNlIiwiXyIsIiRhcHBseSIsInVuc2hpZnQiLCJwYWdpbmF0ZSIsImN1cnJlbnRQYWdlIiwicG9zdHNQZXJQYWdlIiwicHJldlBhZ2UiLCJuZXh0UGFnZSIsImxlbmd0aCIsInNldFBhZ2UiLCJwYWdlX251bWJlciIsInJhbmdlIiwibiIsIkFycmF5IiwicGFnZWRQb3N0cyIsInBhZ2VzIiwiTWF0aCIsImNlaWwiLCJudW1iZXJPZlBhZ2VzIiwiYmVnaW4iLCJlbmQiLCJzbGljZSIsIiR3YXRjaEdyb3VwIiwiJHdhdGNoIiwidGVybSIsImZpbHRlcmVkUG9zdHMiLCJub09mUGFnZXMiLCJnZXQiLCJmaWx0ZXIiLCIkc2NlIiwidmFsIiwidHJ1c3RBc0h0bWwiLCJpbnB1dCIsInN0YXJ0Iiwic2VydmljZSIsInRoaXMiLCJyZWdpc3RlciIsInBhc3N3b3JkX2NvbmZpcm0iLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwid2hlbiIsInRlbXBsYXRlVXJsIiwic3ZjIiwiZGVmYXVsdHMiLCJoZWFkZXJzIiwiY29tbW9uIiwicmVtb3ZlSXRlbSIsInJ1biIsIiR0aW1lb3V0IiwiJHdpbmRvdyIsImNvbm5lY3QiLCJob3N0IiwiY29ubmVjdGlvbiIsIldlYlNvY2tldCIsIm9ub3BlbiIsIm9uY2xvc2UiLCJlIiwib25tZXNzYWdlIiwibWVzc2FnZSIsIkpTT04iLCJwYXJzZSIsIm5hbWUiLCJ0b3BpYyIsIiRicm9hZGNhc3QiXSwibWFwcGluZ3MiOiJBQUNBQSxRQUFBQyxPQUFBLE9BQUEsVUFBQSxjQ0RBRCxRQUFBQyxPQUFBLE9BQ0FDLFdBQUEsbUJBQUEsU0FBQSxhQUFBLFVBQUEsU0FBQUMsRUFBQUMsRUFBQUMsR0FPQUMsT0FBQUMsYUFBQUMsT0FDQUgsRUFBQUksVUFDQUMsS0FBQSxTQUFBQyxHQUNBUixFQUFBUyxNQUFBLGVBQUFELEVBQUFFLFFBSUFWLEVBQUFXLElBQUEsZUFBQSxTQUFBQyxFQUFBQyxHQUNBYixFQUFBYyxZQUFBRCxPQ2hCQWhCLFFBQUFDLE9BQUEsT0FDQUMsV0FBQSxhQUFBLFNBQUEsVUFBQSxTQUFBQyxFQUFBRSxHQUNBRixFQUFBZSxNQUFBLFNBQUFDLEVBQUFDLEdBQ0FmLEVBQUFhLE1BQUFDLEVBQUFDLEdBQ0FWLEtBQUEsU0FBQUMsR0FDQVIsRUFBQVMsTUFBQSxlQUFBRCxFQUFBRSxNQUNBUCxPQUFBZSxTQUFBQyxLQUFBLE1BRUEsU0FBQUMsR0FDQXBCLEVBQUFxQixnQkFBQSwrQ0FLQXJCLEVBQUFzQixPQUFBLFdBQ0FwQixFQUFBb0IsYUNmQXpCLFFBQUFDLE9BQUEsT0FD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QUFBLEdBQUFDLFdBQUFGLEVBRUFDLEdBQUFFLE9BQUEsYUFLQUYsRUFBQUcsUUFBQSxTQUFBQyxHQUVBUixFQUFBRSxFQUFBLE1BR0FFLEVBQUFLLFVBQUEsU0FBQUQsR0FFQSxHQUFBRSxHQUFBQyxLQUFBQyxNQUFBSixFQUFBMUYsTUFFQStGLEVBQUEsTUFBQUgsRUFBQUksTUFDQWhHLEVBQUE0RixFQUFBNUYsSUFHQVQsR0FBQTBHLFdBQUFGLEVBQUEvRiIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL1RoaXMgZmlsZSBtdXN0IGJlIHRoZSBmaXJzdCBpbiB0aGUgbGlzdCB0byBiZSBjb25jYXRlbmF0ZWRcbmFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbJ25nUm91dGUnLCAnbmdBbmltYXRlJ10pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG5cdC5jb250cm9sbGVyKCdBcHBsaWNhdGlvbkN0cmwnICwgW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIlVzZXJTdmNcIiwgZnVuY3Rpb24gKCRzY29wZSwgJHJvb3RTY29wZSwgVXNlclN2Yykge1xuXHRcdC8qXG5cdFx0SWYgd2UgaGF2ZSBhIHN0b3JlZCB0b2tlbiwgZ2V0IHRoZSB1c2VyIGluZm9ybWF0aW9uIGZyb20gaXRcblx0XHRhbmQgZW1pdCB0aGUgdXNlciBsb2dnZWRpbiBtZXNzYWdlcyBpbiBvcmRlciB0byBhbGxvdyB0aGUgVUkgdG8gXG5cdFx0aW5kaWNhdGUgdG8gdGhlIHVzZXIgdGhhdCB0aGV5IHdlcmUgbG9nZ2VkIGluXG5cdFx0Ki9cblx0XHRcblx0XHRpZiAod2luZG93LmxvY2FsU3RvcmFnZS50b2tlbikge1xuXHRcdFx0VXNlclN2Yy5nZXRVc2VyKClcblx0XHRcdFx0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKXtcblx0XHRcdFx0XHQkc2NvcGUuJGVtaXQoJ3VzZXJMb2dnZWRJbicsIHJlc3BvbnNlLmRhdGEpO1xuXHRcdFx0XHR9KVxuXHRcdH1cblxuXHRcdCRzY29wZS4kb24oJ3VzZXJMb2dnZWRJbicsIGZ1bmN0aW9uKGV2ZW50LCB1c2VyKSB7XG5cdFx0XHQkc2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xuXHRcdH0pXG5cdH1dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuY29udHJvbGxlcignTG9naW5DdHJsJyAsIFtcIiRzY29wZVwiICwgXCJVc2VyU3ZjXCIgLCBmdW5jdGlvbiAoJHNjb3BlLCBVc2VyU3ZjKSB7XG5cdFx0JHNjb3BlLmxvZ2luID0gZnVuY3Rpb24gKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuXHRcdFx0VXNlclN2Yy5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXG5cdFx0XHRcdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSl7XG5cdFx0XHRcdFx0JHNjb3BlLiRlbWl0KCd1c2VyTG9nZ2VkSW4nLCByZXNwb25zZS5kYXRhKTtcblx0XHRcdFx0XHR3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcjLydcblx0XHRcdFx0fSxcblx0XHRcdFx0ZnVuY3Rpb24oZXJyb3Ipe1xuXHRcdFx0XHQgICRzY29wZS5sb2dpblZhbGlkYXRpb24gPSAnSW5jb3JyZWN0IHVzZXJuYW1lICYgcGFzc3dvcmQgY29tYmluYXRpb24nO1xuXHRcdFx0XHR9KVxuXG5cdFx0fVxuXG5cdFx0JHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdFVzZXJTdmMubG9nb3V0KClcblx0XHR9XG5cdH1dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuY29udHJvbGxlcignUG9zdHNDdHJsJywgW1wiJHNjb3BlXCIgLCBcIiRodHRwXCIsIFwiUG9zdHNTZXJ2aWNlXCIsIFwiZmlsdGVyRmlsdGVyXCIsIGZ1bmN0aW9uICgkc2NvcGUsICRodHRwLCBQb3N0c1NlcnZpY2UsIGZpbHRlckZpbHRlcikge1xuXHRcdCRzY29wZS5wb3N0cyA9IFtdO1xuXHRcdCRzY29wZS5hZGRQb3N0ID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0dmFyIGNrZWRpdG9yX2NvbnRlbnQgPSBDS0VESVRPUi5pbnN0YW5jZXMuZWRpdG9yMS5nZXREYXRhKCk7XG5cdFx0XHRpZiAoY2tlZGl0b3JfY29udGVudCkge1xuXHRcdFx0XHRQb3N0c1NlcnZpY2Uuc2VuZCh7XG5cdFx0XHRcdFx0Ym9keTogY2tlZGl0b3JfY29udGVudCxcblx0XHRcdFx0XHR0aXRsZTogJHNjb3BlLnBvc3RUaXRsZVxuXHRcdFx0XHR9KVxuXHRcdFx0XHQuc3VjY2VzcyhmdW5jdGlvbiAocG9zdCkge1xuXHRcdFx0XHRcdC8qXG5cdFx0XHRcdFx0Ly9SZW1vdmVkIGFzIHdlYnNvY2tldCBicm9hZGNhc3Qgd291bGQgY2F1c2UgdGhlIHBvc3QgdG8gYXBwZWFyIGR1cGxpY2F0ZWQgb24gdGhlIGJyb3dzZXIgdGhhdCBpdCB3YXMgcG9zdGVkIGZyb20gXG5cdFx0XHRcdFx0Ly9hcyBib3RoIG9mIHRoZSBmdW5jdGlvbnMgd291bGQgZ2V0IGV4ZWN1dGVkIGJlY2F1c2UgdGhlIGNsaWVudCB3aG8gc2VuZHMgdGhlIHBvc3Qgd291bGQgc3RpbGwgcmVjaWV2ZSB0aGUgd2Vic29ja2V0cyBicm9hZGNhc3QgYmFjayBmcm9tIHRoZSBzZXJ2ZXIgIFxuXHRcdFx0XHRcdCovXG5cdFx0XHRcdFx0Ly8kc2NvcGUucG9zdHMudW5zaGlmdChwb3N0KTsgXG5cdFx0XHRcdFx0JHNjb3BlLnBvc3RCb2R5ID0gbnVsbDtcblx0XHRcdFx0XHRDS0VESVRPUi5pbnN0YW5jZXMuZWRpdG9yMS5zZXREYXRhKCcnKTtcblx0XHRcdFx0XHQkc2NvcGUucG9zdFRpdGxlID0gbnVsbDtcblx0XHRcdFx0fSlcblx0XHRcdH1cblx0XHR9XG5cblx0XHQkc2NvcGUuaW5pdF9ja2VkaXQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0ICAgIENLRURJVE9SLnJlcGxhY2UoJ2VkaXRvcjEnKTtcblx0XHR9XG5cblx0XHQkc2NvcGUuJG9uKCd3czpuZXdfcG9zdCcsIGZ1bmN0aW9uKF8sIHBvc3QpIHtcblx0XHRcdHBvc3QgPSBwb3N0WzBdO1xuXHRcdFx0JHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdCRzY29wZS5wb3N0cy51bnNoaWZ0KHBvc3QpO1xuXHRcdFx0XHQkc2NvcGUucGFnaW5hdGUoKTtcblx0XHRcdH0pXG5cdFx0fSlcblxuXHRcdCRzY29wZS4kb24oJyR2aWV3Q29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCl7XG5cdFx0XHQvL3RoZSBwYWdlIGlzIHJlYWR5XG5cdFx0XHQvL2FsZXJ0KFwiZm9vXCIpO1xuXHRcdH0pO1xuXG5cdFx0JHNjb3BlLmN1cnJlbnRQYWdlID0gMTtcblx0XHQkc2NvcGUucG9zdHNQZXJQYWdlID0gNTtcblxuXHRcdCRzY29wZS5wcmV2UGFnZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICBpZiAoJHNjb3BlLmN1cnJlbnRQYWdlID4gMSkge1xuXHQgICAgICAgICAgICAkc2NvcGUuY3VycmVudFBhZ2UtLTtcblx0ICAgICAgICAgICAgJHNjb3BlLnBhZ2luYXRlKCk7XG5cdCAgICAgICAgfVxuXHQgICAgfTtcbiAgICBcblx0ICAgICRzY29wZS5uZXh0UGFnZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICBpZiAoJHNjb3BlLmN1cnJlbnRQYWdlIDwgJHNjb3BlLnBvc3RzLmxlbmd0aC8kc2NvcGUucG9zdHNQZXJQYWdlKSB7XG5cdCAgICAgICAgICAgICRzY29wZS5jdXJyZW50UGFnZSsrO1xuXHQgICAgICAgICAgICAkc2NvcGUucGFnaW5hdGUoKTtcblx0ICAgICAgICB9XG5cdCAgICB9O1xuXHQgICAgXG5cdCAgICAkc2NvcGUuc2V0UGFnZSA9IGZ1bmN0aW9uIChwYWdlX251bWJlcikge1xuXHQgICAgICAgICRzY29wZS5jdXJyZW50UGFnZSA9IHBhZ2VfbnVtYmVyO1xuXHQgICAgICAgICRzY29wZS5wYWdpbmF0ZSgpO1xuXHQgICAgfTtcblxuXHQgICAgLy9UaGlzIHdheSBJIGNhbiBkbzogIFwiPGxpIG5nLXJlcGVhdD1cIm4gaW4gcmFuZ2UocGFnZXMpIHRyYWNrIGJ5ICRpbmRleFwiPlwiIGFuZCBzbyBJIGNhbiBkaXNwbGF5IGFzIG1hbnkgaXRlbXMgYXMgdGhlIHZhbHVlIG9mIGEgbnVtYmVyIGFzIHRoaXMgcmV0dXJucyBhbiBhcnJheSBvZiB0aGF0IGxlbmdodFxuXHQgICAgJHNjb3BlLnJhbmdlID0gZnVuY3Rpb24obikge1xuICAgICAgICBcdHJldHVybiBuZXcgQXJyYXkobik7XG4gICAgXHR9O1xuXG5cdFx0JHNjb3BlLnBhZ2luYXRlID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdCRzY29wZS5wYWdlZFBvc3RzID0gW107XG5cdFx0XHQkc2NvcGUucGFnZXMgPSBNYXRoLmNlaWwoJHNjb3BlLnBvc3RzLmxlbmd0aC8kc2NvcGUucG9zdHNQZXJQYWdlKTtcblxuXHRcdFx0JHNjb3BlLm51bWJlck9mUGFnZXMgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdHJldHVybiBNYXRoLmNlaWwoJHNjb3BlLnBvc3RzLmxlbmd0aCAvICRzY29wZS5wb3N0c1BlclBhZ2UpO1xuXHRcdFx0fTtcblxuXHRcdFx0dmFyIGJlZ2luID0gKCgkc2NvcGUuY3VycmVudFBhZ2UgLTEgKSAqICRzY29wZS5wb3N0c1BlclBhZ2UpO1xuXHRcdFx0dmFyIGVuZCA9IGJlZ2luICsgJHNjb3BlLnBvc3RzUGVyUGFnZTtcblxuXHRcdFx0JHNjb3BlLnBhZ2VkUG9zdHMgPSAkc2NvcGUucG9zdHMuc2xpY2UoYmVnaW4sIGVuZCk7XG5cdFx0fVxuXG5cdFx0JHNjb3BlLiR3YXRjaEdyb3VwKFtcInNlYXJjaC4kXCIsIFwic2VhcmNoLl9hdXRob3IudXNlcm5hbWVcIiAsIFwic2VhcmNoLnRpdGxlXCIgLCBcInNlYXJjaC5kYXRlXCIsLCBcInNlYXJjaC50aXRsZVwiXSwgZnVuY3Rpb24oKSB7XG5cdFx0XHQvL2FsZXJ0KCdwYWdpbmF0aW5nJyk7XG5cdFx0XHQkc2NvcGUucGFnaW5hdGUoKTtcblx0XHR9KTtcblxuXHQgICAgJHNjb3BlLmN1cnJlbnRQYWdlID0gMTsgLy9jdXJyZW50IHBhZ2Vcblx0ICAgICRzY29wZS5wb3N0c1BlclBhZ2UgPSA1OyAvL21heCByb3dzIGZvciBkYXRhIHRhYmxlXG5cblx0ICAgIC8qIGluaXQgcGFnaW5hdGlvbiB3aXRoICRzY29wZS5saXN0ICovXG5cdCAgICAvLyRzY29wZS5ub09mUGFnZXMgPSBNYXRoLmNlaWwoJHNjb3BlLnBvc3RzLmxlbmd0aC8kc2NvcGUucG9zdHNQZXJQYWdlKTtcblx0ICAgIFxuXHQgICAgJHNjb3BlLiR3YXRjaCgnc2VhcmNoJywgZnVuY3Rpb24odGVybSkge1xuXHQgICAgICAgIC8vIENyZWF0ZSAkc2NvcGUuZmlsdGVyZWQgYW5kIHRoZW4gY2FsY3VsYXQgJHNjb3BlLm5vT2ZQYWdlcywgbm8gcmFjaW5nIVxuXHQgICAgICAgICRzY29wZS5maWx0ZXJlZFBvc3RzID0gZmlsdGVyRmlsdGVyKCRzY29wZS5wb3N0cywgdGVybSk7XG5cdCAgICAgICAgJHNjb3BlLm5vT2ZQYWdlcyA9IE1hdGguY2VpbCgkc2NvcGUuZmlsdGVyZWRQb3N0cy5sZW5ndGgvJHNjb3BlLnBvc3RzUGVyUGFnZSk7XG5cdCAgICB9KTtcblxuXG5cdFBvc3RzU2VydmljZS5nZXQoKVxuXHRcdC5zdWNjZXNzKGZ1bmN0aW9uIChwb3N0cykge1xuXHRcdFx0JHNjb3BlLnBvc3RzID0gcG9zdHM7XG5cdFx0XHQkc2NvcGUucGFnaW5hdGUoKTtcblx0XHR9KVxuXG5cdH1dKVxuXG5cdC5maWx0ZXIoJ291dHB1dF9odG1sJywgW1wiJHNjZVwiLCBmdW5jdGlvbiAoJHNjZSkge1xuXHRcdHJldHVybiBmdW5jdGlvbih2YWwpIHtcblx0ICAgICAgICByZXR1cm4gJHNjZS50cnVzdEFzSHRtbCh2YWwpO1xuXHQgICAgfTtcblx0fV0pXG5cblx0LmZpbHRlcignc3RhcnRGcm9tJywgZnVuY3Rpb24oKSB7XG5cdCAgICByZXR1cm4gZnVuY3Rpb24oaW5wdXQsIHN0YXJ0KSB7XG5cdCAgICAgICAgaWYoaW5wdXQpIHtcblx0ICAgICAgICAgICAgc3RhcnQgPSArc3RhcnQ7IC8vcGFyc2UgdG8gaW50XG5cdCAgICAgICAgICAgIHJldHVybiBpbnB1dC5zbGljZShzdGFydCk7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIHJldHVybiBbXTtcblx0ICAgIH1cblx0fSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG5cdC5zZXJ2aWNlKCdQb3N0c1NlcnZpY2UnLCBbXCIkaHR0cFwiICwgZnVuY3Rpb24gKCRodHRwKSB7XG5cdFx0dGhpcy5nZXQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3Bvc3RzJyk7XG5cdFx0fVxuXHRcdHRoaXMuc2VuZCA9IGZ1bmN0aW9uIChwb3N0KSB7XG5cdFx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9wb3N0cycsIHBvc3QpO1xuXHRcdH1cblx0fV0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG5cdC5jb250cm9sbGVyKCdSZWdpc3RlckN0cmwnICwgW1wiJHNjb3BlXCIgLCBcIlVzZXJTdmNcIiAsIGZ1bmN0aW9uICgkc2NvcGUsIFVzZXJTdmMpIHtcblx0XHQkc2NvcGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkLCBwYXNzd29yZF9jb25maXJtKSB7XG5cdFx0XHRpZiAocGFzc3dvcmQgIT0gcGFzc3dvcmRfY29uZmlybSkge1xuXHRcdFx0XHQkc2NvcGUudmFsaWRhdGlvbk1lc3NhZ2UgPSAnWW91ciBwYXNzd29yZHMgZGlkIG5vdCBtYXRjaC4nO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHRVc2VyU3ZjLnJlZ2lzdGVyKHVzZXJuYW1lLCBwYXNzd29yZClcblx0XHR9XG5cdH1dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuY29uZmlnKFtcIiRyb3V0ZVByb3ZpZGVyXCIgLGZ1bmN0aW9uICgkcm91dGVQcm92aWRlcikge1xuXHRcdCRyb3V0ZVByb3ZpZGVyXG5cdFx0XHQud2hlbignLycgLCB7Y29udHJvbGxlcjogJ1Bvc3RzQ3RybCcsIHRlbXBsYXRlVXJsOiAncG9zdHMuaHRtbCd9KVxuXHRcdFx0LndoZW4oJy9yZWdpc3RlcicgLCB7Y29udHJvbGxlcjogJ1JlZ2lzdGVyQ3RybCcsIHRlbXBsYXRlVXJsOiAncmVnaXN0ZXIuaHRtbCd9KVxuXHRcdFx0LndoZW4oJy9sb2dpbicgLCB7Y29udHJvbGxlcjogJ0xvZ2luQ3RybCcsIHRlbXBsYXRlVXJsOiAnbG9naW4uaHRtbCd9KVxuXHRcdFx0LndoZW4oJy9sb2dvdXQnICwge2NvbnRyb2xsZXI6ICdMb2dpbkN0cmwnLCB0ZW1wbGF0ZVVybDogJ2xvZ291dC5odG1sJ30pXG5cdH1dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuc2VydmljZSgnVXNlclN2YycsIFtcIiRodHRwXCIsIGZ1bmN0aW9uKCRodHRwKSB7XG5cdFx0dmFyIHN2YyA9IHRoaXM7XG5cdFx0c3ZjLmdldFVzZXIgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHQkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1BdXRoJ10gPSB3aW5kb3cubG9jYWxTdG9yYWdlLnRva2VuXG5cdFx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzJylcblx0XHRcdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgXHRcdFx0cmV0dXJuIHJlc3BvbnNlXG4gICAgXHRcdH0pXG5cdFx0fVxuXHRcdHN2Yy5sb2dpbiA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQpIHtcblx0XHRcdHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Nlc3Npb25zJywge1xuXHRcdFx0XHR1c2VybmFtZTogdXNlcm5hbWUsIHBhc3N3b3JkOiBwYXNzd29yZFxuXHRcdFx0fSlcblx0XHRcdC50aGVuKGZ1bmN0aW9uICh2YWwpIHtcblx0XHRcdFx0d2luZG93LmxvY2FsU3RvcmFnZS50b2tlbiA9IHZhbC5kYXRhO1xuXHRcdFx0XHQkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1BdXRoJ10gPSB2YWwuZGF0YVxuXHRcdFx0XHRyZXR1cm4gc3ZjLmdldFVzZXIoKTtcblx0XHRcdH0pXG5cdFx0fVxuXHRcdHN2Yy5yZWdpc3RlciA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQsIHBhc3N3b3JkX2NvbmZpcm0pIHtcblx0XHRcdHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3VzZXJzJywge1xuXHRcdFx0XHR1c2VybmFtZTogdXNlcm5hbWUsIHBhc3N3b3JkOiBwYXNzd29yZFxuXHRcdFx0fSlcblx0XHRcdC50aGVuKGZ1bmN0aW9uICh2YWwpIHtcblx0XHRcdFx0cmV0dXJuIHN2Yy5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXG5cdFx0XHRcdFx0LnRoZW4oZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRcdHdpbmRvdy5sb2NhdGlvbi5ocmVmPSAnLyc7XHRcblx0XHRcdFx0XHR9KVxuXHRcdFx0fSlcblx0XHR9XG5cdFx0c3ZjLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgndG9rZW4nKTtcblx0XHRcdHdpbmRvdy5sb2NhdGlvbi5ocmVmPSAnLyc7XG5cdFx0fVxuXHR9XSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbi5ydW4oW1wiJHJvb3RTY29wZVwiLCBcIiR0aW1lb3V0XCIgLCBcIiR3aW5kb3dcIiAsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkdGltZW91dCwgJHdpbmRvdykge1xuXHRcblx0KGZ1bmN0aW9uIGNvbm5lY3QoKXtcblx0XHQvL0NyZWF0ZSBhIHdlYnNvY2tldCBjb25uZWN0aW9uIHdpdGggdGhlIHNlcnZlclxuXHRcdHZhciBob3N0ID0gXCJ3czovL1wiICsgJHdpbmRvdy5sb2NhdGlvbi5ob3N0XG5cdFx0ICBcblx0XHR2YXIgY29ubmVjdGlvbiA9IG5ldyBXZWJTb2NrZXQoaG9zdClcblxuXHRcdGNvbm5lY3Rpb24ub25vcGVuID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0Ly9jb25zb2xlLmxvZygnV2Vic29ja2V0IGNvbm5lY3RlZCcpXG5cdFx0fVxuXG5cblx0XHRjb25uZWN0aW9uLm9uY2xvc2UgPSBmdW5jdGlvbiAoZSkge1xuXHRcdFx0Ly9jb25zb2xlLmxvZygnV2Vic29ja2V0IGNsb3NlZC4gVHJ5aW5nIHRvIHJlY29ubmVjdC4uLicpXG5cdFx0XHQkdGltZW91dChjb25uZWN0LCAxMCoxMDAwKTtcblx0XHR9IFxuXG5cdFx0Y29ubmVjdGlvbi5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkge1xuXHRcdFx0Ly9jb25zb2xlLmxvZyhlKTtcblx0XHRcdHZhciBtZXNzYWdlID0gSlNPTi5wYXJzZShlLmRhdGEpO1xuXHRcdFx0XG5cdFx0XHR2YXIgbmFtZSA9ICd3czonICsgbWVzc2FnZS50b3BpYztcblx0XHRcdHZhciBkYXRhID0gbWVzc2FnZS5kYXRhO1xuXHRcdFx0Ly9jb25zb2xlLmxvZyhcImJyb2FkY2FzdGluZzogXCIpO1xuXG5cdFx0XHQkcm9vdFNjb3BlLiRicm9hZGNhc3QobmFtZSwgZGF0YSk7XG5cdFx0fVxuXHR9KSgpXG59XSkiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=